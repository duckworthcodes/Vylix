<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vylix - Preserving Heritage, Empowering Craftsmen</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸŽ¨</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, signInAnonymously, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut as fbSignOut, updateProfile, GoogleAuthProvider, FacebookAuthProvider, signInWithPopup, RecaptchaVerifier, signInWithPhoneNumber } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, collection, addDoc, getDocs, query, orderBy, where, doc, updateDoc, deleteDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        // Firebase Storage removed; using Cloudinary instead for image uploads
        
        // Your web app's Firebase configuration
        // TODO: Replace with your actual Firebase project configuration
        // Get this from Firebase Console > Project Settings > General > Your apps
        const firebaseConfig = {
            apiKey: "AIzaSyBHiqfF-TsqIvWBJz4JTxu8QdIMbAgqjNI",
            authDomain: "vylix-backend.firebaseapp.com",
            projectId: "vylix-backend",
            storageBucket: "vylix-backend.firebasestorage.app",
            messagingSenderId: "904523782409",
            appId: "1:904523782409:web:2fe8ed4b1eb27d3e4f5bd8",
            measurementId: "G-HCT8R2LVD0"
        };
        
        // App feature configuration (cost control)
        // Set enableStorage to true only if you want to use Firebase Storage (may incur costs)
        const appConfig = { enableStorage: false };
        window.appConfig = appConfig;
        
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        // Firebase Storage removed
        
        // Make Firebase services globally available
        window.firebase = { auth, db, signInAnonymously, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, fbSignOut, updateProfile, GoogleAuthProvider, FacebookAuthProvider, signInWithPopup, RecaptchaVerifier, signInWithPhoneNumber, collection, addDoc, getDocs, query, orderBy, where, doc, updateDoc, deleteDoc };
    </script>
    
    <!--
    FIREBASE SETUP INSTRUCTIONS:
    
    1. Create a Firebase project at https://console.firebase.google.com/
    2. Enable the following services:
       - Authentication (Anonymous sign-in)
       - Firestore Database
       - Storage
    3. Get your Firebase config from Project Settings > General > Your apps
    4. Replace the firebaseConfig object above with your actual configuration
    5. Set up Firestore security rules (see below)
    6. Set up Storage security rules (see below)
    
    FIRESTORE SECURITY RULES:
    rules_version = '2';
    service cloud.firestore {
      match /databases/{database}/documents {
        match /chats/{chatId} {
          allow read, write: if request.auth != null && request.auth.uid == resource.data.userId;
        }
      }
    }
    
    STORAGE SECURITY RULES:
    rules_version = '2';
    service firebase.storage {
      match /b/{bucket}/o {
        match /images/{userId}/{allPaths=**} {
          allow read, write: if request.auth != null && request.auth.uid == userId;
        }
      }
    }
    -->
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary-teal: #10a37f;
            --secondary-red: #b0183d;
            --red-gradient: linear-gradient(135deg, #b0183d, #e84990);
            --glass-bg: rgba(255, 255, 255, 0.15);
            --glass-border: rgba(255, 255, 255, 0.25);
            --text-dark: #000000;
            --text-light: rgba(0, 0, 0, 0.7);
            --chat-bg: #ffffff;
            --sidebar-bg: #f7f7f8;
            --message-user: #10a37f;
            --message-ai: #f1f1f1;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            overflow-x: hidden;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            color: var(--text-dark);
        }
        
        /* Background system */
        .bg-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: -2;
        }
        
        .bg-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0;
            transition: opacity 2s ease-in-out, transform 2s ease;
            transform: scale(1.1);
        }
        
        .bg-image.active {
            opacity: 0.3;
        }
        
        .bg-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, 
                rgba(255, 255, 255, 0.7), 
                rgba(16, 163, 127, 0.1), 
                rgba(176, 24, 61, 0.05));
            z-index: 1;
        }
        
        
        .pinterest-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            opacity: 0;
            transition: opacity 0.5s ease;
            z-index: -1;
        }
        
        .pinterest-bg.active {
            opacity: 0.8;
        }
        
        .pinterest-bg iframe {
            width: 100%;
            height: 100%;
            transform: scale(2);
            filter: blur(3px) opacity(0.6);
        }
        
        /* Navigation Bar */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            padding: 1rem 2rem;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .nav-content {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .nav-link {
            color: var(--text-dark);
            text-decoration: none;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .nav-link:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        
        .nav-link.active::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 2px;
            background: var(--red-gradient);
            border-radius: 1px;
        }
        
        /* Main container */
        .main-container {
            position: relative;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            padding-top: 6rem;
            z-index: 2;
        }
        
        /* Hero section */
        .hero {
            text-align: center;
            margin-bottom: 3rem;
            animation: fadeInUp 1.5s ease;
        }
        
        .logo {
            font-family: 'Dancing Script', cursive;
            font-size: 5rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, var(--primary-teal), var(--secondary-red));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            position: relative;
            animation: titleFloat 3s ease-in-out infinite;
        }
        
        .logo::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 2px;
            background: var(--red-gradient);
            border-radius: 1px;
            animation: underlineGlow 2s ease-in-out infinite alternate;
        }
        
        .tagline {
            font-size: 1.3rem;
            font-weight: 400;
            color: var(--text-light);
            letter-spacing: 0.5px;
            animation: fadeInUp 2s ease 0.5s both;
        }
        
        /* Selection cards */
        .selection-cards {
            display: flex;
            gap: 3rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            justify-content: center;
            animation: fadeInUp 2.5s ease 1s both;
        }
        
        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(8px);
            border-radius: 20px;
            border: 1px solid var(--glass-border);
            padding: 2.5rem;
            width: 320px;
            text-align: center;
            cursor: pointer;
            transition: all 0.4s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .glass-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.2), 
                transparent);
            transition: left 0.5s ease;
        }
        
        .glass-card:hover::before {
            left: 100%;
        }
        
        .glass-card:hover {
            transform: translateY(-15px) scale(1.02);
            background: rgba(255, 255, 255, 0.25);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
        }
        
        .card-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            display: block;
        }
        
        .card-title {
            font-size: 1.6rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 1rem;
        }
        
        .card-description {
            font-size: 1rem;
            color: var(--text-light);
            line-height: 1.6;
        }
        
        /* Dashboard sections */
        .dashboard {
            display: none;
            width: 100%;
            max-width: 1400px;
            animation: fadeInUp 0.5s ease;
        }
        
        .dashboard.active {
            display: block;
        }
        
        /* Initial choice buttons */
        .choice-buttons {
            display: flex;
            gap: 2rem;
            justify-content: center;
            margin: 2rem 0;
        }
        
        .choice-btn {
            padding: 1.5rem 3rem;
            border: none;
            border-radius: 20px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 200px;
        }
        
        .choice-btn.text-mode {
            background: linear-gradient(135deg, var(--primary-teal), #0d8a6b);
            color: white;
        }
        
        
        .choice-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
        }
        
        /* ChatGPT-like interface */
        .chat-interface {
            display: none;
            width: 100%;
            height: 80vh;
            background: var(--chat-bg);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .chat-interface.active {
            display: flex;
        }
        
        .chat-sidebar {
            width: 260px;
            background: var(--sidebar-bg);
            border-right: 1px solid #e5e5e5;
            display: flex;
            flex-direction: column;
            padding: 1rem;
        }
        
        .new-chat-btn {
            background: var(--primary-teal);
            color: white;
            border: none;
            padding: 1rem;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }
        
        .new-chat-btn:hover {
            background: #0d8a6b;
        }
        
        .chat-history {
            flex: 1;
            overflow-y: auto;
        }
        
        .chat-history-item {
            padding: 0.8rem;
            margin-bottom: 0.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s ease;
            font-size: 0.9rem;
            color: var(--text-light);
        }
        
        .chat-history-item:hover {
            background: rgba(16, 163, 127, 0.1);
        }
        
        .chat-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .chat-header {
            padding: 1.5rem 2rem;
            border-bottom: 1px solid #e5e5e5;
            background: white;
        }
        
        .chat-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-dark);
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 2rem;
            background: white;
        }
        
        .message {
            margin-bottom: 2rem;
            display: flex;
            gap: 1rem;
        }
        
        .message.user {
            justify-content: flex-end;
        }
        
        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .message.user .message-avatar {
            background: var(--primary-teal);
            color: white;
            order: 2;
        }
        
        .message.ai .message-avatar {
            background: var(--message-ai);
            color: var(--text-dark);
        }
        
        .message-content {
            max-width: 70%;
            padding: 1rem 1.5rem;
            border-radius: 20px;
            line-height: 1.5;
        }
        
        .message.user .message-content {
            background: linear-gradient(135deg, var(--primary-teal), #0d8a6b);
            color: white;
            border-bottom-right-radius: 5px;
            box-shadow: 0 4px 15px rgba(16, 163, 127, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .message.ai .message-content {
            background: linear-gradient(135deg, #ffffff, #f8f9fa);
            color: var(--text-dark);
            border-bottom-left-radius: 5px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(16, 163, 127, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .message.ai .message-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(180deg, var(--primary-teal), var(--secondary-red));
        }
        
        .chat-input-area {
            padding: 1.5rem 2rem;
            border-top: 1px solid #e5e5e5;
            background: white;
        }
        
        .input-container {
            display: flex;
            gap: 1rem;
            align-items: center;
            background: #f7f7f8;
            border-radius: 25px;
            padding: 0.8rem 1.5rem;
        }
        
        .chat-input {
            flex: 1;
            border: none;
            outline: none;
            background: transparent;
            font-size: 1rem;
            color: var(--text-dark);
            font-family: 'Poppins', sans-serif;
        }
        
        .chat-input::placeholder {
            color: rgba(0, 0, 0, 0.4);
            font-style: italic;
        }
        
        .input-container {
            transition: all 0.3s ease;
        }
        
        .input-container:focus-within {
            background: rgba(16, 163, 127, 0.05);
            border: 2px solid rgba(16, 163, 127, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(16, 163, 127, 0.15);
        }
        
        .input-actions {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }
        
        .action-btn {
            background: none;
            border: none;
            padding: 0.8rem;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            width: 45px;
            height: 45px;
        }
        
        .action-btn:hover {
            background: rgba(16, 163, 127, 0.1);
        }
        
        .send-btn {
            background: linear-gradient(135deg, var(--primary-teal), #0d8a6b);
            color: white;
            width: 45px;
            height: 45px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .send-btn:hover {
            background: linear-gradient(135deg, #0d8a6b, var(--primary-teal));
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(16, 163, 127, 0.3);
        }
        
        .send-btn:active {
            transform: translateY(0);
            box-shadow: 0 4px 15px rgba(16, 163, 127, 0.3);
        }
        
        .send-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }
        
        .send-btn:hover::before {
            left: 100%;
        }
        
        
        /* Product selection for influencers */
        .product-selection {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }
        
        .product-card {
            background: var(--glass-bg);
            backdrop-filter: blur(8px);
            border-radius: 15px;
            border: 1px solid var(--glass-border);
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.25);
        }
        
        .product-image {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, 
                rgba(16, 163, 127, 0.1), 
                rgba(176, 24, 61, 0.1));
            border-radius: 10px;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
        }
        
        .product-info h4 {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.5rem;
        }
        
        .product-info p {
            color: var(--text-light);
            font-size: 0.9rem;
            line-height: 1.5;
        }
        
        /* Back button */
        .back-btn {
            position: absolute;
            top: 2rem;
            left: 2rem;
            padding: 0.8rem 1.5rem;
            background: var(--glass-bg);
            backdrop-filter: blur(8px);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            color: var(--text-dark);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            z-index: 100;
        }
        
        .back-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateX(-5px);
        }
        
        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(40px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes titleFloat {
            0%, 100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-10px);
            }
        }
        
        @keyframes underlineGlow {
            0% {
                box-shadow: 0 0 5px rgba(176, 24, 61, 0.5);
            }
            100% {
                box-shadow: 0 0 20px rgba(176, 24, 61, 0.8);
            }
        }
        
        @keyframes fluidPulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }
        
        @keyframes fluidWave {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
        
        @keyframes activeFluidMotion {
            0% {
                transform: scale(1) rotate(0deg);
                background-position: 0% 50%;
            }
            33% {
                transform: scale(1.1) rotate(120deg);
                background-position: 50% 0%;
            }
            66% {
                transform: scale(0.95) rotate(240deg);
                background-position: 100% 50%;
            }
            100% {
                transform: scale(1) rotate(360deg);
                background-position: 0% 50%;
            }
        }
        
        /* Responsive design */
        @media (max-width: 768px) {
            .logo {
                font-size: 3.5rem;
            }
            
            .selection-cards {
                flex-direction: column;
                align-items: center;
                gap: 2rem;
            }
            
            .glass-card {
                width: 100%;
                max-width: 350px;
            }
            
            .choice-buttons {
                flex-direction: column;
                align-items: center;
                gap: 1rem;
            }
            
            .chat-interface {
                height: 90vh;
            }
            
            .chat-sidebar {
                width: 220px;
            }
            
            .message-content {
                max-width: 85%;
            }
            
            
            .product-selection {
                grid-template-columns: 1fr;
            }
        }
        
        /* Accessibility */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
        
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        
        /* Typing Animation */
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 1rem 1.5rem;
            background: linear-gradient(135deg, #ffffff, #f8f9fa);
            border-radius: 20px;
            border-bottom-left-radius: 5px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(16, 163, 127, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .typing-indicator::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(180deg, var(--primary-teal), var(--secondary-red));
        }
        
        .typing-dots {
            display: flex;
            gap: 0.3rem;
            margin-left: 1rem;
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--primary-teal);
            animation: typingBounce 1.4s infinite ease-in-out;
        }
        
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        .typing-dot:nth-child(3) { animation-delay: 0s; }
        
        @keyframes typingBounce {
            0%, 80%, 100% {
                transform: scale(0);
                opacity: 0.5;
            }
            40% {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        /* Message Animation */
        .message {
            animation: messageSlideIn 0.5s ease-out;
        }
        
        @keyframes messageSlideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Enhanced Response Styling */
        .ai-response-enhanced {
            position: relative;
            padding-left: 1rem;
        }
        
        .response-section {
            margin-bottom: 1rem;
            padding: 0.8rem;
            background: rgba(16, 163, 127, 0.05);
            border-radius: 12px;
            border-left: 3px solid var(--primary-teal);
        }
        
        .response-title {
            font-weight: 600;
            color: var(--primary-teal);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .response-list {
            list-style: none;
            padding: 0;
        }
        
        .response-list li {
            padding: 0.3rem 0;
            position: relative;
            padding-left: 1.5rem;
        }
        
        .response-list li::before {
            content: 'âœ¨';
            position: absolute;
            left: 0;
            top: 0.3rem;
        }
        
        .highlight-box {
            background: linear-gradient(135deg, rgba(16, 163, 127, 0.1), rgba(176, 24, 61, 0.1));
            padding: 1rem;
            border-radius: 12px;
            margin: 0.5rem 0;
            border: 1px solid rgba(16, 163, 127, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        .highlight-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, var(--primary-teal), var(--secondary-red));
        }
        
        .emoji-large {
            font-size: 1.5rem;
            margin-right: 0.5rem;
        }
        
        /* Enhanced AI Response Components */
        .ai-response-card {
            background: linear-gradient(135deg, #ffffff, #f8f9fa);
            border-radius: 16px;
            padding: 1.5rem;
            margin: 1rem 0;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(16, 163, 127, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .ai-response-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-teal), var(--secondary-red), var(--primary-teal));
            background-size: 200% 200%;
            animation: gradientShift 3s ease infinite;
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .craft-type-badge {
            display: inline-block;
            padding: 0.4rem 1rem;
            background: linear-gradient(135deg, var(--primary-teal), var(--secondary-red));
            color: white;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 1rem;
            box-shadow: 0 4px 15px rgba(16, 163, 127, 0.3);
        }
        
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }
        
        .feature-card {
            background: rgba(255, 255, 255, 0.8);
            padding: 1rem;
            border-radius: 12px;
            border: 1px solid rgba(16, 163, 127, 0.1);
            transition: all 0.3s ease;
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(16, 163, 127, 0.15);
        }
        
        .feature-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            display: block;
        }
        
        .feature-title {
            font-weight: 600;
            color: var(--primary-teal);
            margin-bottom: 0.5rem;
        }
        
        .feature-description {
            font-size: 0.9rem;
            color: var(--text-light);
            line-height: 1.4;
        }
        
        .marketing-tips {
            background: linear-gradient(135deg, rgba(16, 163, 127, 0.05), rgba(176, 24, 61, 0.05));
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1rem 0;
            border-left: 4px solid var(--primary-teal);
        }
        
        .tips-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
            color: var(--primary-teal);
            font-weight: 600;
        }
        
        .tip-item {
            background: white;
            padding: 0.8rem;
            margin: 0.5rem 0;
            border-radius: 8px;
            border-left: 3px solid var(--primary-teal);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }
        
        .tip-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 15px rgba(16, 163, 127, 0.1);
        }
        
        .hashtag-container {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 1rem;
            border-radius: 12px;
            margin: 1rem 0;
        }
        
        .hashtag-item {
            display: inline-block;
            background: var(--primary-teal);
            color: white;
            padding: 0.3rem 0.8rem;
            margin: 0.2rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .craft-story {
            background: linear-gradient(135deg, rgba(176, 24, 61, 0.05), rgba(16, 163, 127, 0.05));
            padding: 1.5rem;
            border-radius: 12px;
            margin: 1rem 0;
            border: 1px solid rgba(176, 24, 61, 0.1);
            position: relative;
        }
        
        .story-icon {
            position: absolute;
            top: -10px;
            left: 20px;
            background: white;
            padding: 0.5rem;
            border-radius: 50%;
            font-size: 1.5rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        /* Enhanced Response Styling for Comprehensive AI Responses */
        .response-paragraph {
            margin: 1rem 0;
            line-height: 1.6;
            color: var(--text-dark);
        }
        
        .response-paragraph strong {
            color: var(--primary-teal);
            font-weight: 600;
        }
        
        .bullet-section {
            background: rgba(255, 255, 255, 0.8);
            padding: 1.5rem;
            border-radius: 12px;
            margin: 1rem 0;
            border-left: 4px solid var(--primary-teal);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }
        
        .bullet-title {
            font-weight: 600;
            color: var(--primary-teal);
            margin-bottom: 1rem;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .bullet-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .bullet-item {
            padding: 0.8rem 0;
            border-bottom: 1px solid rgba(16, 163, 127, 0.1);
            position: relative;
            padding-left: 2rem;
            transition: all 0.3s ease;
        }
        
        .bullet-item:last-child {
            border-bottom: none;
        }
        
        .bullet-item:hover {
            background: rgba(16, 163, 127, 0.03);
            padding-left: 2.2rem;
        }
        
        .bullet-item::before {
            content: 'âœ¨';
            position: absolute;
            left: 0;
            top: 0.8rem;
            font-size: 1rem;
            color: var(--primary-teal);
        }
        
        .bullet-item strong {
            color: var(--primary-teal);
            font-weight: 600;
        }
        
        .example-box {
            background: linear-gradient(135deg, rgba(16, 163, 127, 0.08), rgba(176, 24, 61, 0.08));
            padding: 1.2rem;
            border-radius: 12px;
            margin: 0.8rem 0;
            border: 1px solid rgba(16, 163, 127, 0.2);
            font-style: italic;
            position: relative;
        }
        
        .example-box::before {
            content: 'ðŸ’¡';
            position: absolute;
            top: -8px;
            left: 15px;
            background: white;
            padding: 0.3rem;
            border-radius: 50%;
            font-size: 1rem;
        }
        
        .example-text {
            margin-top: 0.5rem;
            padding-left: 1rem;
            color: var(--text-dark);
        }
        
        .marketing-section {
            background: linear-gradient(135deg, rgba(176, 24, 61, 0.05), rgba(16, 163, 127, 0.05));
            padding: 1.5rem;
            border-radius: 12px;
            margin: 1.5rem 0;
            border: 1px solid rgba(176, 24, 61, 0.1);
        }
        
        .marketing-header {
            font-weight: 600;
            color: var(--secondary-red);
            margin-bottom: 1rem;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .marketing-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }
        
        .marketing-card {
            background: white;
            padding: 1.2rem;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            border-left: 3px solid var(--secondary-red);
        }
        
        .marketing-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(176, 24, 61, 0.15);
        }
        
        .marketing-card-title {
            font-weight: 600;
            color: var(--secondary-red);
            margin-bottom: 0.8rem;
            font-size: 1rem;
        }
        
        .marketing-card-content {
            color: var(--text-light);
            line-height: 1.5;
            font-size: 0.9rem;
        }
        
        .hashtag-showcase {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 1.5rem;
            border-radius: 12px;
            margin: 1rem 0;
            text-align: center;
        }
        
        .hashtag-title {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 1rem;
        }
        
        .hashtag-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            justify-content: center;
        }
        
        .hashtag-pill {
            background: linear-gradient(135deg, var(--primary-teal), var(--secondary-red));
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .hashtag-pill:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(16, 163, 127, 0.3);
        }
        
        .conclusion-section {
            background: linear-gradient(135deg, rgba(16, 163, 127, 0.1), rgba(176, 24, 61, 0.1));
            padding: 1.5rem;
            border-radius: 12px;
            margin: 1.5rem 0;
            text-align: center;
            border: 2px solid rgba(16, 163, 127, 0.2);
        }
        
        .conclusion-text {
            font-size: 1.1rem;
            color: var(--text-dark);
            font-weight: 500;
        }
        
        /* Image Upload and Analysis Styling */
        .image-preview-container {
            background: linear-gradient(135deg, #ffffff, #f8f9fa);
            border-radius: 16px;
            padding: 1.5rem;
            margin: 1rem 0;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(16, 163, 127, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .image-preview-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-teal), var(--secondary-red), var(--primary-teal));
            background-size: 200% 200%;
            animation: gradientShift 3s ease infinite;
        }
        
        .uploaded-image {
            width: 100%;
            max-width: 300px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            margin: 1rem auto;
            display: block;
        }
        
        .image-analysis-header {
            font-weight: 600;
            color: var(--primary-teal);
            margin-bottom: 1rem;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }
        
        .analysis-card {
            background: rgba(255, 255, 255, 0.8);
            padding: 1.2rem;
            border-radius: 12px;
            border: 1px solid rgba(16, 163, 127, 0.1);
            transition: all 0.3s ease;
        }
        
        .analysis-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(16, 163, 127, 0.15);
        }
        
        .analysis-card-title {
            font-weight: 600;
            color: var(--primary-teal);
            margin-bottom: 0.8rem;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .analysis-card-content {
            color: var(--text-light);
            line-height: 1.5;
            font-size: 0.9rem;
        }
        
        .confidence-bar {
            background: rgba(16, 163, 127, 0.1);
            border-radius: 10px;
            height: 8px;
            margin: 0.5rem 0;
            overflow: hidden;
        }
        
        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-teal), var(--secondary-red));
            border-radius: 10px;
            transition: width 1s ease;
        }
        
        .confidence-text {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-top: 0.3rem;
        }
        
        .image-loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            color: var(--primary-teal);
        }
        
        .loading-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(16, 163, 127, 0.3);
            border-top: 2px solid var(--primary-teal);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 0.5rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Modern Voice Feature Styles */
        .voice-floating-btn {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-teal), #0d8a6b);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            box-shadow: 0 8px 25px rgba(16, 163, 127, 0.3);
            transition: all 0.3s ease;
            z-index: 1000;
            user-select: none;
        }

        .voice-floating-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 35px rgba(16, 163, 127, 0.4);
        }

        .voice-floating-btn.recording {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            animation: voicePulse 1.5s infinite;
            box-shadow: 0 8px 25px rgba(231, 76, 60, 0.4);
        }

        .voice-floating-btn.processing {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            animation: voiceSpin 2s linear infinite;
        }

        @keyframes voicePulse {
            0% { transform: scale(1); box-shadow: 0 8px 25px rgba(231, 76, 60, 0.4); }
            50% { transform: scale(1.1); box-shadow: 0 12px 35px rgba(231, 76, 60, 0.6); }
            100% { transform: scale(1); box-shadow: 0 8px 25px rgba(231, 76, 60, 0.4); }
        }

        @keyframes voiceSpin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .voice-status-indicator {
            position: fixed;
            bottom: 7rem;
            right: 2rem;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 0.8rem 1.2rem;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: 500;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
            z-index: 1001;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .voice-status-indicator.show {
            opacity: 1;
            transform: translateY(0);
        }

        .voice-stop-btn {
            position: fixed;
            bottom: 7rem;
            right: 2rem;
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            padding: 0.8rem 1.2rem;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 1001;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 25px rgba(231, 76, 60, 0.3);
        }

        .voice-stop-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(231, 76, 60, 0.4);
        }

        .voice-waveform {
            position: fixed;
            bottom: 2rem;
            right: 8rem;
            width: 200px;
            height: 60px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transform: translateX(20px);
            transition: all 0.3s ease;
            z-index: 1001;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .voice-waveform.show {
            opacity: 1;
            transform: translateX(0);
        }

        .waveform-bar {
            width: 3px;
            background: var(--primary-teal);
            margin: 0 1px;
            border-radius: 2px;
            animation: waveformAnimation 1s ease-in-out infinite;
        }

        .waveform-bar:nth-child(1) { height: 20px; animation-delay: 0s; }
        .waveform-bar:nth-child(2) { height: 35px; animation-delay: 0.1s; }
        .waveform-bar:nth-child(3) { height: 25px; animation-delay: 0.2s; }
        .waveform-bar:nth-child(4) { height: 40px; animation-delay: 0.3s; }
        .waveform-bar:nth-child(5) { height: 30px; animation-delay: 0.4s; }
        .waveform-bar:nth-child(6) { height: 35px; animation-delay: 0.5s; }
        .waveform-bar:nth-child(7) { height: 25px; animation-delay: 0.6s; }
        .waveform-bar:nth-child(8) { height: 20px; animation-delay: 0.7s; }

        @keyframes waveformAnimation {
            0%, 100% { transform: scaleY(0.3); }
            50% { transform: scaleY(1); }
        }

        .voice-command-hint {
            position: fixed;
            bottom: 7rem;
            right: 2rem;
            background: linear-gradient(135deg, var(--primary-teal), #0d8a6b);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 15px;
            font-size: 0.9rem;
            max-width: 300px;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
            z-index: 1001;
            box-shadow: 0 8px 25px rgba(16, 163, 127, 0.3);
        }

        .voice-command-hint.show {
            opacity: 1;
            transform: translateY(0);
        }

        .voice-command-hint h4 {
            margin: 0 0 0.5rem 0;
            font-size: 1rem;
        }

        .voice-command-hint ul {
            margin: 0;
            padding-left: 1.2rem;
        }

        .voice-command-hint li {
            margin-bottom: 0.3rem;
            font-size: 0.85rem;
        }

        .voice-error-fix {
            position: fixed;
            bottom: 7rem;
            right: 2rem;
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 15px;
            font-size: 0.9rem;
            max-width: 300px;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
            z-index: 1001;
            box-shadow: 0 8px 25px rgba(231, 76, 60, 0.3);
        }

        .voice-error-fix.show {
            opacity: 1;
            transform: translateY(0);
        }

        .voice-error-fix h4 {
            margin: 0 0 0.5rem 0;
            font-size: 1rem;
        }

        .voice-error-fix button {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.8rem;
            margin-top: 0.5rem;
            transition: all 0.3s ease;
        }

        .voice-error-fix button:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Voice Chat Indicators */
        .voice-indicator, .ai-indicator {
            background: var(--primary-teal);
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            margin-left: 0.5rem;
        }

        .ai-indicator {
            background: #6c757d;
        }

        .message-meta {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 0.5rem;
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .message-time {
            font-size: 0.7rem;
        }

        @media (max-width: 768px) {
            .voice-floating-btn {
                bottom: 1.5rem;
                right: 1.5rem;
                width: 50px;
                height: 50px;
            font-size: 1.2rem;
        }
        
            .voice-status-indicator {
                bottom: 6rem;
                right: 1.5rem;
                font-size: 0.8rem;
                padding: 0.6rem 1rem;
            }

            .voice-waveform {
                bottom: 1.5rem;
                right: 6rem;
                width: 150px;
                height: 50px;
            }

            .voice-command-hint {
                bottom: 6rem;
                right: 1.5rem;
                max-width: 250px;
                font-size: 0.8rem;
            }
        }
        
        .image-error {
            background: rgba(220, 53, 69, 0.1);
            color: #dc3545;
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid rgba(220, 53, 69, 0.2);
            margin: 1rem 0;
        }
        
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="nav-content">
            <a href="#" class="nav-link active" onclick="showMainMenu()">Home</a>
            <a href="#" class="nav-link" onclick="showCraftsmenDashboard()">Craftsmen Dashboard</a>
            <a href="#" class="nav-link" onclick="showInfluencerPlatform()">Influencer Platform</a>
            <a href="shopping.html" class="nav-link">ðŸ›’ Shopping</a>
            <a href="#" class="nav-link">About Vylix</a>
            <a href="#" class="nav-link">Contact</a>
        </div>
    </nav>

    <!-- Background container -->
    <div class="bg-container">
        <img class="bg-image active" src="https://images.pexels.com/photos/8886950/pexels-photo-8886950.jpeg" alt="Crafts close-up">
        <img class="bg-image" src="https://images.pexels.com/photos/318238/pexels-photo-318238.jpeg" alt="Workshop environment">
        <img class="bg-image" src="https://images.pexels.com/photos/7575039/pexels-photo-7575039.jpeg" alt="Textile details">
        <img class="bg-image" src="https://images.pexels.com/photos/31102565/pexels-photo-31102565.jpeg" alt="Artisan hands">
        <div class="bg-overlay"></div>
    </div>
    
    
    <!-- Pinterest-style background -->
    <div class="pinterest-bg">
        <iframe src="https://assets.pinterest.com/ext/embed.html?id=816136763766442185" height="438" width="600" frameborder="0" scrolling="no"></iframe>
    </div>
    
    <!-- Main container -->
    <div class="main-container">
        <!-- Hero Section -->
        <div class="hero" id="heroSection">
            <h1 class="logo">Vylix</h1>
            <p class="tagline">Preserving Heritage, Empowering Craftsmen</p>
        </div>
        
        <!-- Selection Cards -->
        <div class="selection-cards" id="selectionCards">
            <div class="glass-card" onclick="showCraftsmenDashboard()">
                <span class="card-icon">ðŸº</span>
                <h3 class="card-title">Craftsmen Dashboard</h3>
                <p class="card-description">AI-powered tools to enhance your craft photography, generate compelling descriptions, and reach wider audiences</p>
            </div>
            <div class="glass-card" onclick="showInfluencerPlatform()">
                <span class="card-icon">ðŸ“±</span>
                <h3 class="card-title">Influencer Platform</h3>
                <p class="card-description">Collaborate with authentic craftsmen, access heritage templates, and showcase traditional Indian artistry</p>
            </div>
        </div>
        
        <!-- Craftsmen Dashboard -->
        <div class="dashboard" id="craftsmenDashboard">
            <button class="back-btn" onclick="showMainMenu()" aria-label="Back to main menu">â† Back to Main</button>
            
            <!-- Initial Choice -->
            <div id="craftsmenChoice">
                <h2 style="text-align: center; margin-bottom: 2rem; font-size: 2rem; color: var(--text-dark);">Choose Your Interaction Method</h2>
                <div class="choice-buttons">
                    <button class="choice-btn text-mode" onclick="showTextInterface()">ðŸ“ Use Text</button>
                </div>
            </div>
            
            <!-- Text Interface (ChatGPT-like) -->
            <div class="chat-interface" id="textInterface">
                <div class="chat-sidebar">
                    <button class="new-chat-btn" onclick="startNewChat()">+ New Chat</button>
                    <div class="chat-history" id="chatHistory">
                        <!-- Saved chats will be loaded here -->
                    </div>
                    <div style="margin-top: auto; padding-top: 1rem; border-top: 1px solid #e5e5e5;">
                        <div id="profileEntry" style="font-size: 0.8rem; color: var(--text-light); padding: 0.5rem; cursor: pointer;" onclick="showProfile()">ðŸ‘¤ Sign in / Register</div>
                        <div style="font-size: 0.8rem; color: var(--primary-teal); padding: 0.5rem; font-weight: 600;">ðŸ¤– AI Active</div>
                        <div style="font-size: 0.8rem; color: var(--secondary-red); padding: 0.5rem; cursor: pointer;" onclick="clearAllChats()">ðŸ—‘ï¸ Clear All</div>
                    </div>
                </div>
                
                <div class="chat-panel">
                    <div class="chat-header">
                        <div class="chat-title">
                            Craft Description Assistant 
                            <span style="font-size: 0.8rem; margin-left: 1rem; padding: 0.2rem 0.6rem; border-radius: 12px; background: #d4edda; color: #155724; font-weight: 600;">
                                ðŸ¤– Gemini AI Active
                            </span>
                        </div>
                    </div>
                    
                    <div class="chat-messages" id="chatMessages">
                        <div class="message ai">
                            <div class="message-avatar">ðŸ¤–</div>
                            <div class="message-content">
                                Hello! I'm Vylix AI powered by Google Gemini! ðŸŒŸ I can help you create compelling craft descriptions, suggest marketing strategies, and provide insights about traditional Indian artistry. What would you like to work on today?
                            </div>
                        </div>
                    </div>
                    
                    <div class="chat-input-area">
                        <div class="input-container">
                            <input type="text" class="chat-input" placeholder="Describe your craft or ask for help..." id="chatInput">
                            <div class="input-actions">
                                <input type="file" id="imageUpload" accept="image/*" style="display: none;" onchange="handleImageUpload(event)">
                                <button class="action-btn" onclick="document.getElementById('imageUpload').click()" title="Upload Image">ðŸ“·</button>
                                <button class="action-btn" onclick="showPricingHelper()" title="Pricing Helper">ðŸ’°</button>
                                <button class="action-btn" onclick="showDescribeOptions()" title="Describe It">ðŸ“</button>
                                <button class="action-btn" onclick="saveCurrentChat()" title="Save Chat" id="saveChatBtn" style="display: none;">ðŸ’¾</button>
                                <button class="send-btn action-btn" onclick="sendMessage()" title="Send Message">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Auth Modal (Login / Register) - styled like the reference -->
            <style>
                .auth-overlay { position: fixed; inset: 0; background: linear-gradient(135deg, rgba(254,243,226,0.7) 0%, rgba(249,232,201,0.7) 100%); backdrop-filter: blur(6px); -webkit-backdrop-filter: blur(6px); opacity: 0; pointer-events: none; transition: opacity 220ms ease; z-index: 98; }
                .auth-overlay.active { opacity: 1; pointer-events: auto; }
                .auth-modal { position: fixed; inset: 0; display: grid; place-items: center; pointer-events: none; z-index: 99; }
                .auth-card { width: 420px; max-width: 92vw; background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border: 1px solid rgba(0,0,0,0.06); box-shadow: 0 10px 30px rgba(0,0,0,0.10); border-radius: 24px; transform: translateY(12px) scale(0.98); opacity: 0; transition: all 260ms ease; pointer-events: none; position: relative; overflow: hidden; }
                .auth-card::before { content: ""; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: radial-gradient(circle at center, rgba(255, 215, 0, 0.18), transparent 55%); opacity: 0.35; transform: rotate(45deg); }
                .auth-card.active { transform: translateY(0) scale(1); opacity: 1; }
                .auth-header { padding: 1.1rem 1.25rem 0.25rem; display: flex; align-items: center; justify-content: space-between; }
                .auth-title { font-weight: 800; color: #78350f; letter-spacing: 0.3px; font-size: 1.4rem; }
                .auth-sub { color: #6b7280; font-size: 0.95rem; margin-top: 0.1rem; }
                .auth-close { background: transparent; border: none; font-size: 1.2rem; color: var(--text-light); cursor: pointer; }
                .auth-tabs { display: grid; grid-template-columns: 1fr 1fr; margin: 0.75rem 0.95rem; border: 1px solid #ececec; border-radius: 14px; overflow: hidden; }
                .auth-tab { text-align: center; padding: 0.65rem 0.8rem; font-weight: 700; color: #6b7280; cursor: pointer; background: rgba(255,255,255,0.75); }
                .auth-tab.active { color: #92400e; background: #fff7ed; }
                .auth-toggle { display: flex; align-items: center; justify-content: center; margin: 0.35rem 1.1rem 0.6rem; }
                .auth-toggle-pill { position: relative; width: 160px; height: 36px; background: #f3f4f6; border: 1px solid #e5e7eb; border-radius: 999px; cursor: pointer; display: grid; grid-template-columns: 1fr 1fr; overflow: hidden; }
                .auth-toggle-knob { position: absolute; top: 2px; left: 2px; width: 76px; height: 32px; background: #fff7ed; border: 1px solid #fde68a; border-radius: 999px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); transition: transform 180ms ease; }
                .auth-toggle-pill.register .auth-toggle-knob { transform: translateX(80px); }
                .auth-toggle-label { z-index: 1; display: grid; place-items: center; font-weight: 700; font-size: 0.85rem; color: #6b7280; }
                .auth-toggle-pill.login .auth-toggle-label--login { color: #92400e; }
                .auth-toggle-pill.register .auth-toggle-label--register { color: #92400e; }
                .auth-body { padding: 0.75rem 1.25rem 1.1rem; position: relative; z-index: 1; }
                .auth-label { display: block; font-size: 0.85rem; font-weight: 600; color: #374151; margin: 0.5rem 0 0.35rem; }
                .auth-input { width: 100%; padding: 0.7rem 0.85rem; border-radius: 12px; border: 1px solid #e5e7eb; background: rgba(255,255,255,0.95); color: var(--text-dark); outline: none; transition: border 120ms ease, box-shadow 120ms ease; }
                .auth-input:focus { border-color: #d97706; box-shadow: 0 0 0 3px rgba(217, 119, 6, 0.12); }
                .auth-input-row { position: relative; }
                .auth-eye { position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer; color: #9ca3af; }
                .auth-actions { display: flex; align-items: center; justify-content: space-between; gap: 0.75rem; margin-top: 0.9rem; }
                .btn-auth { padding: 0.8rem 1rem; border-radius: 12px; border: 1px solid #e5e7eb; background: white; cursor: pointer; font-weight: 700; transition: transform 160ms ease, box-shadow 160ms ease, background 160ms ease; }
                .btn-auth:hover { transform: translateY(-2px); box-shadow: 0 6px 18px rgba(0,0,0,0.08); }
                .btn-auth.primary { background: #d97706; border-color: #d97706; color: white; width: 100%; }
                .btn-auth.primary:hover { background: #b45309; }
                .auth-divider { display: grid; grid-template-columns: 1fr auto 1fr; align-items: center; gap: 0.75rem; margin: 1rem 0; color: #6b7280; font-size: 0.85rem; }
                .auth-divider::before, .auth-divider::after { content: ""; height: 1px; background: #ececec; }
                .socials { display: grid; grid-template-columns: 1fr 1fr; gap: 0.7rem; }
                .social-btn { border: 1px solid #e5e7eb; background: rgba(255,255,255,0.98); border-radius: 12px; padding: 0.65rem; font-weight: 700; cursor: pointer; transition: background 160ms ease, transform 160ms ease, box-shadow 160ms ease; }
                .social-btn:hover { background: #f9fafb; transform: translateY(-2px); box-shadow: 0 6px 18px rgba(0,0,0,0.06); }
                .auth-hint { font-size: 0.85rem; color: #6b7280; text-align: center; margin-top: 0.6rem; }
                .auth-error { color: #b42318; background: #fee4e2; border: 1px solid #fecdca; padding: 0.55rem 0.7rem; border-radius: 10px; font-size: 0.85rem; margin-top: 0.5rem; display: none; }
                .auth-ornament { position: absolute; opacity: 0.12; font-size: 6.5rem; color: #d97706; pointer-events: none; z-index: 0; }
            </style>
            <div id="authOverlay" class="auth-overlay" onclick="closeAuthModal()"></div>
            <div id="authModal" class="auth-modal" role="dialog" aria-hidden="true" onclick="closeAuthModal()">
                <div id="authCard" class="auth-card" onclick="event.stopPropagation()">
                    <div class="auth-ornament" style="top: -8px; left: 10px;">ðŸª”</div>
                    <div class="auth-ornament" style="bottom: -16px; right: 8px;">ðŸº</div>
                    <div class="auth-header">
                        <div>
                            <div class="auth-title" style="font-family: 'Playfair Display', serif;">Welcome to Vylix</div>
                            <div class="auth-sub">Preserving Heritage, Empowering Craftsmen</div>
                        </div>
                        <button class="auth-close" onclick="closeAuthModal()" aria-label="Close">âœ•</button>
                    </div>
                    <div class="auth-tabs">
                        <div id="tabLogin" class="auth-tab active" onclick="switchAuthTab('login')">Login</div>
                        <div id="tabRegister" class="auth-tab" onclick="switchAuthTab('register')">Register</div>
                    </div>
                    <div class="auth-toggle">
                        <div id="authToggle" class="auth-toggle-pill login" onclick="toggleAuthMode()">
                            <div class="auth-toggle-knob"></div>
                            <div class="auth-toggle-label auth-toggle-label--login">Login</div>
                            <div class="auth-toggle-label auth-toggle-label--register">Register</div>
                        </div>
                    </div>
                    <div class="auth-body">
                        <div id="authError" class="auth-error"></div>
                        <div id="loginForm">
                            <label class="auth-label" for="loginEmail">Email</label>
                            <input id="loginEmail" class="auth-input" type="email" placeholder="you@example.com">
                            <label class="auth-label" for="loginPassword">Password</label>
                            <div class="auth-input-row">
                                <input id="loginPassword" class="auth-input" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                                <span class="auth-eye" onclick="togglePassword('loginPassword', this)">ðŸ‘ï¸</span>
                            </div>
                            <div style="display:flex; align-items:center; justify-content: space-between; margin-top: 8px; color:#6b7280; font-size:0.85rem;">
                                <label style="display:flex; align-items:center; gap:6px; cursor:pointer;">
                                    <input id="rememberEmail" type="checkbox"> Remember email
                                </label>
                                <a href="#" onclick="continueGuest(); return false;" style="color:#92400e; font-weight:700;">Continue without account</a>
                            </div>
                            <div class="auth-actions">
                                <button id="loginBtn" class="btn-auth primary" onclick="submitLogin()">Sign In</button>
                            </div>
                            <div class="auth-divider">or continue with</div>
                            <div class="socials">
                                <button class="social-btn" onclick="oauthSignIn('google')">Google</button>
                                <button class="social-btn" onclick="openPhoneAuth()">Phone</button>
                            </div>
                            <div id="phoneSection" style="display:none; margin-top:10px;">
                                <label class="auth-label" for="phoneNumber">Phone Number</label>
                                <input id="phoneNumber" class="auth-input" type="tel" placeholder="+1 555 000 0000">
                                <div id="recaptchaContainer" style="margin-top:8px;"></div>
                                <div class="auth-actions" style="margin-top:10px;">
                                    <button id="sendOtpBtn" class="btn-auth" onclick="sendOtp()">Send OTP</button>
                                </div>
                                <div id="otpRow" style="display:none; margin-top:10px;">
                                    <label class="auth-label" for="otpCode">Enter OTP</label>
                                    <input id="otpCode" class="auth-input" type="text" placeholder="6-digit code">
                                    <div class="auth-actions" style="margin-top:10px;">
                                        <button id="verifyOtpBtn" class="btn-auth primary" onclick="verifyOtp()">Verify & Sign In</button>
                                    </div>
                                </div>
                            </div>
                            <div class="auth-hint">New here? <a href="#" onclick="switchAuthTab('register'); return false;">Create an account</a></div>
                        </div>
                        <div id="registerForm" style="display:none;">
                            <label class="auth-label" for="regName">Full Name</label>
                            <input id="regName" class="auth-input" type="text" placeholder="e.g., Aastha Virdi">
                            <label class="auth-label" for="regEmail">Email</label>
                            <input id="regEmail" class="auth-input" type="email" placeholder="you@example.com">
                            <label class="auth-label" for="regPassword">Password</label>
                            <div class="auth-input-row">
                                <input id="regPassword" class="auth-input" type="password" placeholder="Min 6 characters" oninput="updatePasswordMeter()">
                                <span class="auth-eye" onclick="togglePassword('regPassword', this)">ðŸ‘ï¸</span>
                            </div>
                            <div style="height:8px; background:#f3f4f6; border-radius:999px; overflow:hidden; margin-top:6px;"><div id="pwBar" style="height:100%; width:0%; border-radius:999px;"></div></div>
                            <label class="auth-label" for="regConfirm">Confirm Password</label>
                            <div class="auth-input-row">
                                <input id="regConfirm" class="auth-input" type="password" placeholder="Re-enter password">
                                <span class="auth-eye" onclick="togglePassword('regConfirm', this)">ðŸ‘ï¸</span>
                            </div>
                            <div class="auth-actions">
                                <button id="registerBtn" class="btn-auth primary" onclick="submitRegister()">Create Account</button>
                            </div>
                            <div class="auth-hint">Already have an account? <a href="#" onclick="switchAuthTab('login'); return false;">Sign in</a></div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="offlineBanner" style="position:fixed; top:8px; left:50%; transform:translateX(-50%); background:#fef3c7; color:#92400e; border:1px solid #fde68a; padding:6px 12px; border-radius:999px; font-weight:700; box-shadow:0 6px 14px rgba(0,0,0,0.06); z-index:120; display:none;">You are offline. Some features are unavailable.</div>
            <div id="toast" style="position:fixed; bottom:18px; left:50%; transform:translateX(-50%); background:#111827; color:white; padding:10px 14px; border-radius:12px; font-weight:600; box-shadow:0 10px 20px rgba(0,0,0,0.25); z-index:130; display:none;"></div>
            
            <!-- Modern Voice Feature -->
            <button class="voice-floating-btn" id="voiceBtn" onclick="toggleVoiceRecording()" title="Click to start voice input">
                ðŸŽ¤
            </button>
            
            <div class="voice-status-indicator" id="voiceStatus">
                Click the microphone to start
                    </div>
                    
            <div class="voice-stop-btn" id="voiceStopBtn" onclick="voiceAssistant.stopRecording()" style="display: none;">
                â¹ï¸ Stop & Process
                </div>
                
            <div class="voice-waveform" id="voiceWaveform">
                <div class="waveform-bar"></div>
                <div class="waveform-bar"></div>
                <div class="waveform-bar"></div>
                <div class="waveform-bar"></div>
                <div class="waveform-bar"></div>
                <div class="waveform-bar"></div>
                <div class="waveform-bar"></div>
                <div class="waveform-bar"></div>
                </div>
                
            <div class="voice-command-hint" id="voiceCommandHint">
                <h4>ðŸŽ™ï¸ Voice Commands</h4>
                <ul>
                    <li>"Generate description" - Create AI description</li>
                    <li>"Ask AI" - Ask any question</li>
                    <li>"What can you do" - See capabilities</li>
                    <li>"Tell me about" - Learn about topics</li>
                    <li>"Clear chat" - Clear conversation</li>
                    <li>"Help" - Show this menu</li>
                </ul>
                    </div>
                    
            <div class="voice-error-fix" id="voiceErrorFix">
                <h4>ðŸ”§ Voice Issue Detected</h4>
                <p>Voice recognition not working. Try these fixes:</p>
                <button onclick="voiceAssistant.testVoiceRecognition()">ðŸ§ª Test Voice</button>
                <button onclick="voiceAssistant.testMicrophoneAccess()">ðŸŽ¤ Test Microphone</button>
                <button onclick="voiceAssistant.retryVoiceRecognition()">ðŸ”„ Retry Voice</button>
                <button onclick="voiceAssistant.showManualInputOption()">âœï¸ Use Text Instead</button>
                    </div>
                
        </div>
        
        <!-- Influencer Platform -->
        <div class="dashboard" id="influencerPlatform">
            <button class="back-btn" onclick="showMainMenu()" aria-label="Back to main menu">â† Back to Main</button>
            
            <div style="text-align: center; margin-bottom: 3rem;">
                <h2 style="font-size: 2.5rem; color: var(--text-dark); margin-bottom: 1rem;">Influencer Collaboration Hub</h2>
                <p style="font-size: 1.1rem; color: var(--text-light); max-width: 600px; margin: 0 auto;">Connect with authentic craftsmen and create compelling content that celebrates Indian heritage</p>
            </div>
            
            <!-- Product Selection -->
            <div style="margin-bottom: 2rem;">
                <h3 style="color: var(--text-dark); margin-bottom: 1rem; font-size: 1.5rem;">Select Products to Feature</h3>
                <div class="product-selection">
                    <div class="product-card" onclick="selectProduct('textiles')">
                        <div class="product-image">ðŸ§µ</div>
                        <div class="product-info">
                            <h4>Handwoven Textiles</h4>
                            <p>Traditional sarees, scarves, and fabrics with intricate patterns and heritage techniques</p>
                        </div>
                    </div>
                    
                    <div class="product-card" onclick="selectProduct('pottery')">
                        <div class="product-image">ðŸº</div>
                        <div class="product-info">
                            <h4>Ceramic & Pottery</h4>
                            <p>Handcrafted pottery, decorative items, and functional ceramics using ancient methods</p>
                        </div>
                    </div>
                    
                    <div class="product-card" onclick="selectProduct('jewelry')">
                        <div class="product-image">ðŸ’</div>
                        <div class="product-info">
                            <h4>Traditional Jewelry</h4>
                            <p>Silver, gold, and beaded jewelry featuring traditional motifs and craftsmanship</p>
                        </div>
                    </div>
                    
                    <div class="product-card" onclick="selectProduct('woodwork')">
                        <div class="product-image">ðŸªµ</div>
                        <div class="product-info">
                            <h4>Wood Crafts</h4>
                            <p>Carved sculptures, furniture, and decorative wooden items from skilled artisans</p>
                        </div>
                    </div>
                    
                    <div class="product-card" onclick="selectProduct('metalwork')">
                        <div class="product-image">âš’ï¸</div>
                        <div class="product-info">
                            <h4>Metal Crafts</h4>
                            <p>Brass, copper, and iron craftwork including utensils, decorative items, and tools</p>
                        </div>
                    </div>
                    
                    <div class="product-card" onclick="selectProduct('paintings')">
                        <div class="product-image">ðŸŽ¨</div>
                        <div class="product-info">
                            <h4>Traditional Art</h4>
                            <p>Miniature paintings, folk art, and traditional canvas works from various regions</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Influencer Tools -->
            <div style="background: var(--glass-bg); backdrop-filter: blur(8px); border-radius: 20px; border: 1px solid var(--glass-border); padding: 2rem; margin-bottom: 2rem;">
                <h3 style="color: var(--text-dark); margin-bottom: 1.5rem; font-size: 1.5rem;">Content Creation Tools</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                    <button class="camera-btn" onclick="openCollaborationHub()" style="padding: 1.5rem;">
                        ðŸ¤ Collaboration Hub<br>
                        <small style="font-weight: 400; opacity: 0.8;">Connect with craftsmen</small>
                    </button>
                    <button class="camera-btn" onclick="openTemplates()" style="padding: 1.5rem;">
                        ðŸŽ¨ Heritage Templates<br>
                        <small style="font-weight: 400; opacity: 0.8;">Ready-made content layouts</small>
                    </button>
                    <button class="camera-btn" onclick="openAnalytics()" style="padding: 1.5rem;">
                        ðŸ“Š Performance Analytics<br>
                        <small style="font-weight: 400; opacity: 0.8;">Track engagement & reach</small>
                    </button>
                    <button class="camera-btn" onclick="openCampaignManager()" style="padding: 1.5rem;">
                        ðŸ“… Campaign Manager<br>
                        <small style="font-weight: 400; opacity: 0.8;">Schedule & manage posts</small>
                    </button>
                    <button class="camera-btn" onclick="openStoryMaker()" style="padding: 1.5rem;">
                        ðŸ“± Story Maker<br>
                        <small style="font-weight: 400; opacity: 0.8;">Create heritage stories</small>
                    </button>
                    <button class="camera-btn" onclick="openReelEditor()" style="padding: 1.5rem;">
                        ðŸŽ¥ Reel Editor<br>
                        <small style="font-weight: 400; opacity: 0.8;">Edit craft videos</small>
                    </button>
                </div>
            </div>
            
            <!-- Trending Crafts -->
            <div style="background: var(--glass-bg); backdrop-filter: blur(8px); border-radius: 20px; border: 1px solid var(--glass-border); padding: 2rem;">
                <h3 style="color: var(--text-dark); margin-bottom: 1.5rem; font-size: 1.5rem;">Trending Crafts This Week</h3>
                <div style="display: flex; gap: 1rem; overflow-x: auto; padding-bottom: 1rem;">
                    <div style="min-width: 200px; background: rgba(255,255,255,0.1); border-radius: 12px; padding: 1rem; text-align: center;">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">ðŸ§µ</div>
                        <div style="font-weight: 600; color: var(--text-dark);">Kantha Embroidery</div>
                        <div style="font-size: 0.8rem; color: var(--text-light);">+23% engagement</div>
                    </div>
                    <div style="min-width: 200px; background: rgba(255,255,255,0.1); border-radius: 12px; padding: 1rem; text-align: center;">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">ðŸº</div>
                        <div style="font-weight: 600; color: var(--text-dark);">Blue Pottery</div>
                        <div style="font-size: 0.8rem; color: var(--text-light);">+18% engagement</div>
                    </div>
                    <div style="min-width: 200px; background: rgba(255,255,255,0.1); border-radius: 12px; padding: 1rem; text-align: center;">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">ðŸ’</div>
                        <div style="font-weight: 600; color: var(--text-dark);">Temple Jewelry</div>
                        <div style="font-size: 0.8rem; color: var(--text-light);">+15% engagement</div>
                    </div>
                    <div style="min-width: 200px; background: rgba(255,255,255,0.1); border-radius: 12px; padding: 1rem; text-align: center;">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">ðŸŽ¨</div>
                        <div style="font-weight: 600; color: var(--text-dark);">Madhubani Art</div>
                        <div style="font-size: 0.8rem; color: var(--text-light);">+12% engagement</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    
    <script>
        // Global state
        let currentBgIndex = 0;
        let chatMessages = [];
        let savedChats = JSON.parse(localStorage.getItem('vylixChats')) || [];
        let currentChatId = null;
        let currentUser = null;
        let firebaseReady = false;
        
        // Firebase initialization
        async function initializeFirebase() {
            try {
                // Wait for Firebase to be available
                while (!window.firebase) {
                    await new Promise(resolve => setTimeout(resolve, 100));
                }
                
                // Sign in anonymously
                const { auth, signInAnonymously, onAuthStateChanged } = window.firebase;
                
                // Listen for auth state changes
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        currentUser = user;
                        console.log('âœ… User authenticated:', user.uid);
                        loadChatHistoryFromFirebase();
                    } else {
                        console.log('âŒ User not authenticated');
                    }
                });
                
                // Sign in anonymously
                await signInAnonymously(auth);
                firebaseReady = true;
                console.log('âœ… Firebase initialized successfully');
                
            } catch (error) {
                console.error('âŒ Firebase initialization failed:', error);
                // Fallback to localStorage
                firebaseReady = false;
            }
        }
        
        // Initialize Firebase when page loads
        initializeFirebase();
        
        // Firestore functions
        async function saveChatToFirebase(chatData) {
            if (!firebaseReady || !currentUser) {
                console.log('Firebase not ready, falling back to localStorage');
                return false;
            }
            
            try {
                const { db, collection, addDoc, doc, updateDoc } = window.firebase;
                
                // Sanitize messages: do not store large base64 blobs in Firestore
                const sanitizedMessages = (chatData.messages || []).map(m => {
                    const copy = { ...m };
                    if (typeof copy.content === 'string' && copy.content.startsWith('data:image/')) {
                        copy.content = '[image uploaded]';
                    }
                    // Strip any content fields over 300KB to avoid large doc costs
                    if (typeof copy.content === 'string' && copy.content.length > 300 * 1024) {
                        copy.content = copy.content.slice(0, 2048) + '... [truncated]';
                    }
                    return copy;
                });
                
                if (currentChatId && currentChatId !== chatData.id) {
                    // Update existing chat
                    const chatRef = doc(db, 'chats', currentChatId);
                    await updateDoc(chatRef, {
                        title: chatData.title,
                        messages: sanitizedMessages,
                        updatedAt: new Date().toISOString()
                    });
                    console.log('âœ… Chat updated in Firestore');
                } else {
                    // Add new chat
                    const docRef = await addDoc(collection(db, 'chats'), {
                        userId: currentUser.uid,
                        title: chatData.title,
                        messages: sanitizedMessages,
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    });
                    currentChatId = docRef.id;
                    console.log('âœ… Chat saved to Firestore with ID:', docRef.id);
                }
                return true;
            } catch (error) {
                console.error('âŒ Error saving chat to Firestore:', error);
                return false;
            }
        }
        
        async function loadChatHistoryFromFirebase() {
            if (!firebaseReady || !currentUser) {
                console.log('Firebase not ready, using localStorage');
                loadChatHistory();
                return;
            }
            
            try {
                const { db, collection, getDocs, query, where, orderBy } = window.firebase;
                
                const q = query(
                    collection(db, 'chats'),
                    where('userId', '==', currentUser.uid),
                    orderBy('updatedAt', 'desc')
                );
                
                const querySnapshot = await getDocs(q);
                savedChats = [];
                
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    savedChats.push({
                        id: doc.id,
                        title: data.title,
                        messages: data.messages,
                        createdAt: data.createdAt,
                        updatedAt: data.updatedAt
                    });
                });
                
                console.log('âœ… Loaded', savedChats.length, 'chats from Firestore');
                loadChatHistory();
                
            } catch (error) {
                console.error('âŒ Error loading chats from Firestore:', error);
                loadChatHistory(); // Fallback to localStorage
            }
        }
        
        async function deleteChatFromFirebase(chatId) {
            if (!firebaseReady || !currentUser) {
                console.log('Firebase not ready, using localStorage');
                return false;
            }
            
            try {
                const { db, doc, deleteDoc } = window.firebase;
                await deleteDoc(doc(db, 'chats', chatId));
                console.log('âœ… Chat deleted from Firestore');
                return true;
            } catch (error) {
                console.error('âŒ Error deleting chat from Firestore:', error);
                return false;
            }
        }
        
        // Background rotation
        const bgImages = document.querySelectorAll('.bg-image');
        const totalImages = bgImages.length;
        
        function rotateBackground() {
            bgImages[currentBgIndex].classList.remove('active');
            currentBgIndex = (currentBgIndex + 1) % totalImages;
            bgImages[currentBgIndex].classList.add('active');
        }
        
        setInterval(rotateBackground, 4000);
        
        // Navigation functions
        function showMainMenu() {
            document.getElementById('heroSection').style.display = 'block';
            document.getElementById('selectionCards').style.display = 'flex';
            document.getElementById('craftsmenDashboard').classList.remove('active');
            document.getElementById('influencerPlatform').classList.remove('active');
            
            // Reset all interfaces
            resetInterfaces();
        }
        
        function showCraftsmenDashboard() {
            document.getElementById('heroSection').style.display = 'none';
            document.getElementById('selectionCards').style.display = 'none';
            document.getElementById('craftsmenDashboard').classList.add('active');
            document.getElementById('influencerPlatform').classList.remove('active');
            
            // Show initial choice
            document.getElementById('craftsmenChoice').style.display = 'block';
            document.getElementById('textInterface').classList.remove('active');
        }
        
        function showInfluencerPlatform() {
            document.getElementById('heroSection').style.display = 'none';
            document.getElementById('selectionCards').style.display = 'none';
            document.getElementById('influencerPlatform').classList.add('active');
            document.getElementById('craftsmenDashboard').classList.remove('active');
        }
        
        function showTextInterface() {
            document.getElementById('craftsmenChoice').style.display = 'none';
            document.getElementById('textInterface').classList.add('active');
            
            // Activate Pinterest background
            document.querySelector('.pinterest-bg').classList.add('active');
        }
        
        
        function resetInterfaces() {
            document.querySelector('.pinterest-bg').classList.remove('active');
            
        }
        
        // Chat interface functions
        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (message) {
                addMessage('user', message);
                input.value = '';
                
                // Simulate AI response
                setTimeout(() => {
                    generateAIResponse(message);
                }, 1000);
            }
        }
        
        function addMessage(sender, content, isTyping = false) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            if (isTyping) {
            messageDiv.innerHTML = `
                    <div class="message-avatar">ðŸ¤–</div>
                    <div class="typing-indicator">
                        <span>AI is crafting your response</span>
                        <div class="typing-dots">
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                        </div>
                    </div>
                `;
            } else {
                const avatar = sender === 'user' ? 'ðŸ‘¤' : 'ðŸ¤–';
                // Don't enhance AI responses when loading - they're already enhanced
                const messageContent = content;
                
                messageDiv.innerHTML = `
                    <div class="message-avatar">${avatar}</div>
                    <div class="message-content">${messageContent}</div>
                `;
            }
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            // Add entrance animation
            setTimeout(() => {
                messageDiv.style.opacity = '1';
                messageDiv.style.transform = 'translateY(0)';
            }, 10);
            
            // Store message in chat history (only for non-typing messages)
            if (!isTyping) {
                chatMessages.push({
                    sender: sender,
                    content: content,
                    timestamp: new Date().toISOString()
                });
                
                // Show save button after first user message
                if (sender === 'user' && chatMessages.filter(msg => msg.sender === 'user').length === 1) {
                    document.getElementById('saveChatBtn').style.display = 'block';
                }
            }
        }
        
        function enhanceAIResponse(content) {
            // Add beautiful formatting to AI responses
            let enhanced = content;
            
            // Add section headers with enhanced styling
            enhanced = enhanced.replace(/ðŸŽ¯ Content Strategy:/g, '<div class="response-section"><div class="response-title">ðŸŽ¯ Content Strategy</div>');
            enhanced = enhanced.replace(/ðŸ“¸ Photo Ideas:/g, '</div><div class="response-section"><div class="response-title">ðŸ“¸ Photo Ideas</div>');
            enhanced = enhanced.replace(/ðŸ“ Caption Tips:/g, '</div><div class="response-section"><div class="response-title">ðŸ“ Caption Tips</div>');
            
            // Convert bullet points to styled lists with feature cards
            enhanced = enhanced.replace(/â€¢ (.+)/g, '<div class="tip-item">âœ¨ $1</div>');
            
            // Add highlight boxes for important tips
            enhanced = enhanced.replace(/ðŸ’¡ Marketing tip: (.+)/g, '<div class="highlight-box"><strong>ðŸ’¡ Marketing Tip:</strong> $1</div>');
            enhanced = enhanced.replace(/âœ¨ Pro tip: (.+)/g, '<div class="highlight-box"><strong>âœ¨ Pro Tip:</strong> $1</div>');
            enhanced = enhanced.replace(/ðŸ“± Perfect for (.+)/g, '<div class="highlight-box"><strong>ðŸ“± Perfect for:</strong> $1</div>');
            
            // Add hashtag styling
           
            enhanced = enhanced.replace(/#(\w+)/g, '<span class="hashtag-item">#$1</span>');
            
            // Add craft story sections
            if (content.toLowerCase().includes('story') || content.toLowerCase().includes('heritage')) {
                enhanced = enhanced.replace(/(.+story.+.+heritage.+)/gi, '<div class="craft-story"><div class="story-icon">ðŸ“–</div><div style="margin-top: 1rem;">$1</div></div>');
            }
            
            // Add marketing tips container
            if (content.toLowerCase().includes('marketing') || content.toLowerCase().includes('tip')) {
                enhanced = enhanced.replace(/(ðŸ’¡|âœ¨|ðŸ“±).+(tip|marketing).+?(?=<|$)/gi, '<div class="marketing-tips"><div class="tips-header">$1 Marketing Insights</div>$&</div>');
            }
            
            // Close any open sections
            if (enhanced.includes('<div class="response-section">')) {
                enhanced += '</div>';
            }
            
            return enhanced;
        }
        
        // Google Gemini AI Integration
        let GEMINI_API_KEY = 'AIzaSyCukoC7hMflk9GlUipAbKnG4_eTM8VZuYI'; // Will be loaded from localStorage
        const GEMINI_API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent';
        
        async function generateAIResponse(userMessage) {
            // Show beautiful typing indicator
            addMessage('ai', '', true);
            
            try {
                console.log('ðŸš€ Calling Gemini API...');
                console.log('API Key:', GEMINI_API_KEY.substring(0, 10) + '...');
                console.log('Message:', userMessage);
                console.log('Chat history:', chatMessages);
                
                // Build conversation context
                let conversationContext = '';
                if (chatMessages.length > 1) { // More than just the initial AI message
                    conversationContext = '\n\nConversation History:\n';
                    chatMessages.forEach((msg, index) => {
                        if (msg.sender === 'user') {
                            conversationContext += `User: ${msg.content}\n`;
                        } else if (msg.sender === 'ai') {
                            conversationContext += `AI: ${msg.content}\n`;
                        }
                    });
                }
                
                const response = await fetch(`${GEMINI_API_URL}?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: `You are Vylix AI, a specialized assistant for Indian crafts and heritage products. Help craftspersons create compelling product descriptions and marketing content.

User's current message: "${userMessage}"${conversationContext}

Please provide a helpful, engaging response that:
1. Focuses on the craft's cultural significance and heritage
2. Suggests marketing strategies if relevant
3. Maintains a warm, knowledgeable tone
4. Is concise but informative
5. Includes emojis where appropriate
6. References previous conversation context when relevant
7. Builds upon previous discussions naturally

If the user is asking about a specific craft, provide detailed information about materials, techniques, cultural background, and marketing suggestions. Remember the conversation context and refer back to previous topics when appropriate.`
                            }]
                        }]
                    })
                });
                
                console.log('ðŸ“¡ Response status:', response.status);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('âŒ API Error Response:', errorText);
                    throw new Error(`API request failed: ${response.status} - ${errorText}`);
                }
                
                const data = await response.json();
                console.log('âœ… API Response:', data);
                
                if (data.candidates && data.candidates[0] && data.candidates[0].content) {
                    const aiResponse = data.candidates[0].content.parts[0].text;
                    console.log('ðŸŽ¯ AI Response:', aiResponse);
                    
                    // Remove the loading message and add the AI response
                    const messagesContainer = document.getElementById('chatMessages');
                    messagesContainer.removeChild(messagesContainer.lastChild);
                    addMessage('ai', aiResponse);
                } else {
                    console.error('âŒ Invalid response format:', data);
                    throw new Error('Invalid response format from Gemini API');
                }
                
            } catch (error) {
                console.error('âŒ Error calling Gemini API:', error);
                
                // Fallback to enhanced local responses
                const messagesContainer = document.getElementById('chatMessages');
                messagesContainer.removeChild(messagesContainer.lastChild);
                
                const fallbackResponse = getEnhancedFallbackResponse(userMessage);
                console.log('ðŸ”„ Using fallback response:', fallbackResponse);
                addMessage('ai', fallbackResponse);
            }
        }
        
        function getEnhancedFallbackResponse(userMessage) {
            const responses = {
                'pottery': 'ðŸº This beautiful handcrafted pottery showcases traditional Indian ceramic artistry! Each piece is uniquely shaped and fired using ancient techniques passed down through generations. Perfect for both decorative and functional use, highlighting the rich cultural heritage of Indian craftsmanship. ðŸ’¡ Marketing tip: Highlight the artisan\'s story and the traditional techniques used!',
                'jewelry': 'ðŸ’ Exquisite traditional jewelry featuring intricate metalwork and authentic design patterns! These pieces represent centuries of skilled craftsmanship, combining precious metals with traditional motifs that tell stories of Indian cultural heritage. âœ¨ Pro tip: Create content showing the detailed craftsmanship process!',
                'textile': 'ðŸ§µ Magnificent handwoven textile displaying masterful weaving techniques and traditional patterns! Each thread tells a story of heritage, creating a fabric that embodies the rich cultural traditions of Indian artistry. ðŸ“± Perfect for Instagram content showcasing the weaving process!',
                'wood': 'ðŸªµ Stunning wooden craftsmanship featuring intricate carvings and traditional techniques! Each piece represents the skill and patience of master woodworkers. ðŸŒŸ Great for lifestyle content showing the piece in home settings!',
                'metal': 'âš’ï¸ Beautiful metalwork showcasing traditional forging and engraving techniques! These pieces combine functionality with artistic beauty. ðŸ”¥ Consider creating videos showing the metalworking process!',
                'art': 'ðŸŽ¨ Traditional Indian art pieces that capture the essence of cultural heritage! Each artwork tells a story and represents centuries of artistic tradition. ðŸ“¸ Perfect for creating educational content about art history!',
                'jute': 'ðŸ‘œ <strong>Authentic Jute Bag from Rajasthan</strong>\n\nâœ¨ <strong>Craft Heritage:</strong> These eco-friendly bags showcase traditional craftsmanship passed down through generations of skilled artisans.\n\nðŸŒ± <strong>Sustainable Appeal:</strong> Perfect for environmentally conscious consumers who appreciate heritage crafts with cultural significance.\n\nðŸ’¡ Marketing tip: Highlight the artisan\'s story and the traditional jute weaving techniques used!\n\nðŸ“± Perfect for Instagram content showcasing the weaving process and sustainable lifestyle!',
                'bag': 'ðŸ‘œ This traditional bag represents the perfect blend of functionality and cultural heritage! Crafted with attention to detail, it showcases the artisan\'s skill and the rich traditions of Indian craftsmanship. Perfect for those who value authentic, handcrafted products with a story to tell. ðŸ“± Great for lifestyle content showing everyday use!',
                'instagram': 'ðŸ“± <strong>Instagram Showcase Ideas for Your Craft</strong>\n\nðŸŽ¯ Content Strategy:\nâ€¢ Behind-the-scenes videos of the making process\nâ€¢ Before/after transformation posts\nâ€¢ Styling tips and outfit combinations\nâ€¢ Customer testimonials and reviews\nâ€¢ Cultural stories and artisan interviews\n\nðŸ“¸ Photo Ideas:\nâ€¢ Flat lay compositions with props\nâ€¢ Lifestyle shots in natural settings\nâ€¢ Close-up details showing craftsmanship\nâ€¢ Before/after comparisons\nâ€¢ Multiple angles and perspectives\n\nðŸ“ Caption Tips:\nâ€¢ Share the artisan\'s story\nâ€¢ Highlight sustainable materials\nâ€¢ Use relevant hashtags #handmade #sustainable #heritage #craft #artisan #traditional\nâ€¢ Include call-to-actions\nâ€¢ Tag related accounts and locations\n\nðŸ’¡ Pro Tip: Create a content calendar and post consistently to build your audience!',
                'default': 'ðŸŒŸ I can help you create compelling descriptions for your craft! Please tell me more about your product - what materials are used, the techniques involved, and any cultural significance it holds. This will help me generate the perfect marketing description and content strategy! ðŸ’¡'
            };
            
            let response = responses.default;
            const message = userMessage.toLowerCase();
            
            if (message.includes('instagram') || message.includes('showcase') || message.includes('social media')) response = responses.instagram;
            else if (message.includes('jute')) response = responses.jute;
            else if (message.includes('bag')) response = responses.bag;
            else if (message.includes('pottery') || message.includes('ceramic')) response = responses.pottery;
            else if (message.includes('jewelry') || message.includes('jewellery') || message.includes('silver') || message.includes('gold')) response = responses.jewelry;
            else if (message.includes('textile') || message.includes('fabric') || message.includes('saree') || message.includes('cloth')) response = responses.textile;
            else if (message.includes('wood') || message.includes('carving') || message.includes('sculpture')) response = responses.wood;
            else if (message.includes('metal') || message.includes('brass') || message.includes('copper') || message.includes('iron')) response = responses.metal;
            else if (message.includes('art') || message.includes('painting') || message.includes('miniature')) response = responses.art;
            
            return response;
        }
        
        
        async function generateAIDescription(transcript) {
            document.getElementById('aiDescription').textContent = 'ðŸ¤” AI is generating description...';
            
            try {
                const response = await fetch(`${GEMINI_API_URL}?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: `Create a professional product description for this craft based on the user's description: "${transcript}"

Make it engaging, highlight traditional techniques, and make it appealing to customers.`
                            }]
                        }]
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`API request failed: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.candidates && data.candidates[0] && data.candidates[0].content) {
                    const aiResponse = data.candidates[0].content.parts[0].text;
                    document.getElementById('aiDescription').textContent = aiResponse;
                } else {
                    throw new Error('Invalid response format from Gemini API');
                }
                
            } catch (error) {
                console.error('Error calling Gemini API:', error);
                document.getElementById('aiDescription').textContent = 'Sorry, there was an error generating the description. Please try again.';
            }
        }
        
        
        
        
        // Action functions
        function showDescribeOptions() {
            const describeModal = `
                <div id="describeModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; display: flex; align-items: center; justify-content: center;" onclick="closeDescribeModalOnClick(event)">
                    <div style="background: white; border-radius: 20px; padding: 2rem; max-width: 600px; width: 90%; max-height: 85vh; overflow-y: auto; position: relative;" onclick="event.stopPropagation()">
                        <h3 style="color: var(--primary-teal); margin-bottom: 1rem; text-align: center;">ðŸ“ Craft Description Assistant</h3>
                        <p style="color: var(--text-light); margin-bottom: 1.5rem; text-align: center;">Choose how you'd like to describe your craft</p>
                        <div style="position: absolute; top: 1rem; right: 1rem; cursor: pointer; font-size: 1.5rem; color: #999; transition: color 0.3s ease;" onclick="closeDescribeModal()" onmouseover="this.style.color='#666'" onmouseout="this.style.color='#999'" title="Close (or click outside)">Ã—</div>
                        
                        <div style="display: grid; grid-template-columns: 1fr; gap: 1.5rem; margin-bottom: 2rem; max-width: 400px; margin-left: auto; margin-right: auto;">
                            
                            <div style="background: linear-gradient(135deg, rgba(176, 24, 61, 0.1), rgba(176, 24, 61, 0.05)); padding: 1.5rem; border-radius: 15px; border: 2px solid rgba(176, 24, 61, 0.2); cursor: pointer; transition: all 0.3s ease;" onclick="startManualDescription()" onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 10px 25px rgba(176, 24, 61, 0.2)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                                <div style="text-align: center; font-size: 3rem; margin-bottom: 1rem;">âœï¸</div>
                                <h4 style="color: var(--secondary-red); margin-bottom: 0.5rem; text-align: center;">Manual Entry</h4>
                                <p style="color: var(--text-light); font-size: 0.9rem; text-align: center; line-height: 1.4;">Fill out a guided form to create detailed descriptions</p>
                            </div>
                        </div>
                        
                        <div style="background: rgba(16, 163, 127, 0.05); padding: 1.5rem; border-radius: 15px; margin-bottom: 1.5rem;">
                            <h4 style="color: var(--primary-teal); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                                ðŸ’¡ Quick Tips
                            </h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; font-size: 0.9rem; color: var(--text-light);">
                                <div>â€¢ Mention materials used</div>
                                <div>â€¢ Describe the technique</div>
                                <div>â€¢ Include cultural significance</div>
                                <div>â€¢ Highlight unique features</div>
                                <div>â€¢ Mention time invested</div>
                                <div>â€¢ Add personal story</div>
                            </div>
                        </div>
                        
                        <div style="text-align: center;">
                            <button onclick="closeDescribeModal()" style="padding: 0.8rem 2rem; background: #f8f9fa; color: var(--text-dark); border: 2px solid #e5e5e5; border-radius: 10px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.background='#e9ecef'" onmouseout="this.style.background='#f8f9fa'">
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', describeModal);
            
            // Add keyboard support for Escape key
            const handleEscapeKey = (event) => {
                if (event.key === 'Escape') {
                    closeDescribeModal();
                    document.removeEventListener('keydown', handleEscapeKey);
                }
            };
            document.addEventListener('keydown', handleEscapeKey);
        }
        
        function showPricingHelper() {
            const pricingModal = `
                <div id="pricingModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; display: flex; align-items: center; justify-content: center;" onclick="closePricingModalOnClick(event)">
                    <div style="background: white; border-radius: 20px; padding: 2rem; max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto; position: relative;" onclick="event.stopPropagation()">
                        <h3 style="color: var(--primary-teal); margin-bottom: 1rem; text-align: center;">ðŸ’° AI Pricing Helper</h3>
                        <p style="color: var(--text-light); margin-bottom: 1.5rem; text-align: center;">Get AI-powered pricing suggestions for your craft</p>
                        <div style="position: absolute; top: 1rem; right: 1rem; cursor: pointer; font-size: 1.5rem; color: #999; transition: color 0.3s ease;" onclick="closePricingModal()" onmouseover="this.style.color='#666'" onmouseout="this.style.color='#999'" title="Close (or click outside)">Ã—</div>
                        
                        <div style="margin-bottom: 1rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--text-dark);">Craft Type:</label>
                            <select id="craftType" style="width: 100%; padding: 0.8rem; border: 2px solid #e5e5e5; border-radius: 10px; font-size: 1rem;">
                                <option value="">Select craft type...</option>
                                <option value="pottery">Pottery & Ceramics</option>
                                <option value="jewelry">Jewelry & Accessories</option>
                                <option value="textile">Textiles & Fabrics</option>
                                <option value="woodwork">Wood Crafts</option>
                                <option value="metalwork">Metal Crafts</option>
                                <option value="paintings">Art & Paintings</option>
                            </select>
                        </div>
                        
                        <div style="margin-bottom: 1rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--text-dark);">Materials Used:</label>
                            <input type="text" id="materials" placeholder="e.g., Pure silver, silk thread, natural clay..." style="width: 100%; padding: 0.8rem; border: 2px solid #e5e5e5; border-radius: 10px; font-size: 1rem;">
                        </div>
                        
                        <div style="margin-bottom: 1rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--text-dark);">Time Invested (hours):</label>
                            <input type="number" id="timeInvested" placeholder="e.g., 8" style="width: 100%; padding: 0.8rem; border: 2px solid #e5e5e5; border-radius: 10px; font-size: 1rem;">
                        </div>
                        
                        <div style="margin-bottom: 1.5rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--text-dark);">Complexity Level:</label>
                            <select id="complexity" style="width: 100%; padding: 0.8rem; border: 2px solid #e5e5e5; border-radius: 10px; font-size: 1rem;">
                                <option value="">Select complexity...</option>
                                <option value="basic">Basic (Simple design)</option>
                                <option value="intermediate">Intermediate (Moderate detail)</option>
                                <option value="advanced">Advanced (Highly detailed)</option>
                                <option value="expert">Expert (Master-level work)</option>
                            </select>
                        </div>
                        
                        <div style="display: flex; gap: 1rem;">
                            <button onclick="calculatePricing()" style="flex: 1; padding: 1rem; background: linear-gradient(135deg, var(--primary-teal), #0d8a6b); color: white; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;">
                                ðŸ’° Get Price Estimate
                            </button>
                            <button onclick="closePricingModal()" style="flex: 1; padding: 1rem; background: #f8f9fa; color: var(--text-dark); border: 2px solid #e5e5e5; border-radius: 10px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;">
                                Cancel
                            </button>
                        </div>
                        
                        <div id="pricingResult" style="margin-top: 1.5rem; padding: 1rem; background: rgba(16, 163, 127, 0.1); border-radius: 10px; display: none;">
                            <h4 style="color: var(--primary-teal); margin-bottom: 0.5rem;">ðŸ’¡ AI Price Suggestion:</h4>
                            <div id="pricingDetails"></div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', pricingModal);
            
            // Add keyboard support for Escape key
            const handleEscapeKey = (event) => {
                if (event.key === 'Escape') {
                    closePricingModal();
                    document.removeEventListener('keydown', handleEscapeKey);
                }
            };
            document.addEventListener('keydown', handleEscapeKey);
        }
        
        function calculatePricing() {
            const craftType = document.getElementById('craftType').value;
            const materials = document.getElementById('materials').value;
            const timeInvested = parseInt(document.getElementById('timeInvested').value) || 0;
            const complexity = document.getElementById('complexity').value;
            
            if (!craftType || !materials || !timeInvested || !complexity) {
                alert('Please fill in all fields to get a price estimate!');
                return;
            }
            
            // AI-powered pricing calculation
            let basePrice = 0;
            let materialMultiplier = 1;
            let complexityMultiplier = 1;
            let timeMultiplier = 1;
            
            // Base pricing by craft type
            const basePrices = {
                'pottery': 500,
                'jewelry': 800,
                'textile': 300,
                'woodwork': 400,
                'metalwork': 600,
                'paintings': 700
            };
            
            basePrice = basePrices[craftType] || 500;
            
            // Material multiplier
            if (materials.toLowerCase().includes('silver') || materials.toLowerCase().includes('gold')) {
                materialMultiplier = 2.5;
            } else if (materials.toLowerCase().includes('silk') || materials.toLowerCase().includes('premium')) {
                materialMultiplier = 1.8;
            } else if (materials.toLowerCase().includes('natural') || materials.toLowerCase().includes('organic')) {
                materialMultiplier = 1.3;
            }
            
            // Complexity multiplier
            const complexityMultipliers = {
                'basic': 1,
                'intermediate': 1.5,
                'advanced': 2.2,
                'expert': 3.5
            };
            complexityMultiplier = complexityMultipliers[complexity] || 1;
            
            // Time multiplier (more time = higher value)
            timeMultiplier = Math.max(1, timeInvested / 8); // 8 hours as baseline
            
            const estimatedPrice = Math.round(basePrice * materialMultiplier * complexityMultiplier * timeMultiplier);
            const minPrice = Math.round(estimatedPrice * 0.8);
            const maxPrice = Math.round(estimatedPrice * 1.2);
            
            const pricingDetails = `
                <div style="font-size: 1.5rem; font-weight: 700; color: var(--primary-teal); margin-bottom: 1rem;">
                    â‚¹${minPrice.toLocaleString()} - â‚¹${maxPrice.toLocaleString()}
                </div>
                <div style="font-size: 0.9rem; color: var(--text-light); margin-bottom: 1rem;">
                    <strong>Recommended:</strong> â‚¹${estimatedPrice.toLocaleString()}
                </div>
                <div style="font-size: 0.8rem; color: var(--text-light);">
                    <div>ðŸ“Š <strong>Pricing Factors:</strong></div>
                    <div>â€¢ Craft Type: ${craftType.charAt(0).toUpperCase() + craftType.slice(1)}</div>
                    <div>â€¢ Materials: ${materials}</div>
                    <div>â€¢ Time: ${timeInvested} hours</div>
                    <div>â€¢ Complexity: ${complexity.charAt(0).toUpperCase() + complexity.slice(1)}</div>
                </div>
                <div style="margin-top: 1rem; padding: 0.8rem; background: rgba(16, 163, 127, 0.1); border-radius: 8px; font-size: 0.8rem;">
                    <strong>ðŸ’¡ Pro Tips:</strong><br>
                    â€¢ Consider your local market rates<br>
                    â€¢ Factor in your skill level and reputation<br>
                    â€¢ Include material costs + 30% markup<br>
                    â€¢ Add 20% for unique/one-of-a-kind pieces
                </div>
            `;
            
            document.getElementById('pricingDetails').innerHTML = pricingDetails;
            document.getElementById('pricingResult').style.display = 'block';
        }
        
        function closePricingModal() {
            const modal = document.getElementById('pricingModal');
            if (modal) {
                modal.remove();
            }
        }
        
        function closePricingModalOnClick(event) {
            // Only close if clicking on the backdrop (not the modal content)
            if (event.target.id === 'pricingModal') {
                closePricingModal();
            }
        }
        
        
        function startManualDescription() {
            closeDescribeModal();
            const manualModal = `
                <div id="manualDescribeModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; display: flex; align-items: center; justify-content: center;" onclick="closeManualDescribeModalOnClick(event)">
                    <div style="background: white; border-radius: 20px; padding: 2rem; max-width: 700px; width: 90%; max-height: 90vh; overflow-y: auto; position: relative;" onclick="event.stopPropagation()">
                        <h3 style="color: var(--primary-teal); margin-bottom: 1rem; text-align: center;">âœï¸ Manual Description Builder</h3>
                        <p style="color: var(--text-light); margin-bottom: 1.5rem; text-align: center;">Fill out the details to create a compelling description</p>
                        <div style="position: absolute; top: 1rem; right: 1rem; cursor: pointer; font-size: 1.5rem; color: #999; transition: color 0.3s ease;" onclick="closeManualDescribeModal()" onmouseover="this.style.color='#666'" onmouseout="this.style.color='#999'" title="Close (or click outside)">Ã—</div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--text-dark);">Craft Name/Title:</label>
                                <input type="text" id="craftName" placeholder="e.g., Handwoven Silk Saree" style="width: 100%; padding: 0.8rem; border: 2px solid #e5e5e5; border-radius: 10px; font-size: 1rem;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--text-dark);">Craft Type:</label>
                                <select id="manualCraftType" style="width: 100%; padding: 0.8rem; border: 2px solid #e5e5e5; border-radius: 10px; font-size: 1rem;">
                                    <option value="">Select type...</option>
                                    <option value="pottery">Pottery & Ceramics</option>
                                    <option value="jewelry">Jewelry & Accessories</option>
                                    <option value="textile">Textiles & Fabrics</option>
                                    <option value="woodwork">Wood Crafts</option>
                                    <option value="metalwork">Metal Crafts</option>
                                    <option value="paintings">Art & Paintings</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 1.5rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--text-dark);">Materials Used:</label>
                            <input type="text" id="manualMaterials" placeholder="e.g., Pure silk, gold thread, natural dyes..." style="width: 100%; padding: 0.8rem; border: 2px solid #e5e5e5; border-radius: 10px; font-size: 1rem;">
                        </div>
                        
                        <div style="margin-bottom: 1.5rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--text-dark);">Techniques Used:</label>
                            <input type="text" id="techniques" placeholder="e.g., Hand weaving, block printing, traditional embroidery..." style="width: 100%; padding: 0.8rem; border: 2px solid #e5e5e5; border-radius: 10px; font-size: 1rem;">
                        </div>
                        
                        <div style="margin-bottom: 1.5rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--text-dark);">Cultural Significance/Story:</label>
                            <textarea id="culturalStory" placeholder="Tell the story behind your craft, its cultural importance, or personal significance..." style="width: 100%; padding: 0.8rem; border: 2px solid #e5e5e5; border-radius: 10px; font-size: 1rem; min-height: 80px; resize: vertical;"></textarea>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--text-dark);">Time Invested:</label>
                                <input type="text" id="manualTime" placeholder="e.g., 2 days, 8 hours, 1 week..." style="width: 100%; padding: 0.8rem; border: 2px solid #e5e5e5; border-radius: 10px; font-size: 1rem;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--text-dark);">Special Features:</label>
                                <input type="text" id="specialFeatures" placeholder="e.g., Eco-friendly, one-of-a-kind, traditional method..." style="width: 100%; padding: 0.8rem; border: 2px solid #e5e5e5; border-radius: 10px; font-size: 1rem;">
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 1.5rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--text-dark);">Target Audience:</label>
                            <select id="targetAudience" style="width: 100%; padding: 0.8rem; border: 2px solid #e5e5e5; border-radius: 10px; font-size: 1rem;">
                                <option value="">Select target audience...</option>
                                <option value="collectors">Art Collectors</option>
                                <option value="fashion">Fashion Enthusiasts</option>
                                <option value="home">Home Decor Lovers</option>
                                <option value="gifts">Gift Buyers</option>
                                <option value="tourists">Tourists/Souvenir Buyers</option>
                                <option value="general">General Public</option>
                            </select>
                        </div>
                        
                        <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                            <button onclick="generateDescriptionFromForm(event)" style="flex: 1; padding: 1rem; background: linear-gradient(135deg, var(--primary-teal), #0d8a6b); color: white; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                                âœ¨ Generate Description
                            </button>
                            <button onclick="testDescriptionGeneration()" style="padding: 1rem; background: linear-gradient(135deg, var(--secondary-red), #a0153a); color: white; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                                ðŸ§ª Test
                            </button>
                            <button onclick="closeManualDescribeModal()" style="flex: 1; padding: 1rem; background: #f8f9fa; color: var(--text-dark); border: 2px solid #e5e5e5; border-radius: 10px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.background='#e9ecef'" onmouseout="this.style.background='#f8f9fa'">
                                Cancel
                            </button>
                        </div>
                        
                        <div id="generatedDescription" style="margin-top: 1.5rem; padding: 1.5rem; background: rgba(16, 163, 127, 0.05); border-radius: 15px; display: none;">
                            <h4 style="color: var(--primary-teal); margin-bottom: 1rem;">âœ¨ Generated Description:</h4>
                            <div id="descriptionContent" style="line-height: 1.6; color: var(--text-dark);"></div>
                            <div style="margin-top: 1rem; display: flex; gap: 0.5rem;">
                                <button onclick="copyDescription()" style="padding: 0.5rem 1rem; background: var(--primary-teal); color: white; border: none; border-radius: 8px; font-size: 0.9rem; cursor: pointer;">ðŸ“‹ Copy</button>
                                <button onclick="sendDescriptionToChat()" style="padding: 0.5rem 1rem; background: var(--secondary-red); color: white; border: none; border-radius: 8px; font-size: 0.9rem; cursor: pointer;">ðŸ’¬ Send to Chat</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', manualModal);
            
            // Add keyboard support for Escape key
            const handleEscapeKey = (event) => {
                if (event.key === 'Escape') {
                    closeManualDescribeModal();
                    document.removeEventListener('keydown', handleEscapeKey);
                }
            };
            document.addEventListener('keydown', handleEscapeKey);
        }
        
        function generateDescriptionFromForm() {
            console.log('Generating description...');
            
            const craftName = document.getElementById('craftName').value;
            const craftType = document.getElementById('manualCraftType').value;
            const materials = document.getElementById('manualMaterials').value;
            const techniques = document.getElementById('techniques').value;
            const culturalStory = document.getElementById('culturalStory').value;
            const timeInvested = document.getElementById('manualTime').value;
            const specialFeatures = document.getElementById('specialFeatures').value;
            const targetAudience = document.getElementById('targetAudience').value;
            
            console.log('Form data:', { craftName, craftType, materials, techniques, culturalStory, timeInvested, specialFeatures, targetAudience });
            
            if (!craftName || !craftType || !materials) {
                alert('Please fill in at least the craft name, type, and materials!');
                return;
            }
            
            // Show loading state
            const generateBtn = event.target;
            const originalText = generateBtn.innerHTML;
            generateBtn.innerHTML = 'â³ Generating...';
            generateBtn.disabled = true;
            
            // Generate AI-powered description
            try {
                const description = generateAIFormDescription({
                    craftName, craftType, materials, techniques, culturalStory, timeInvested, specialFeatures, targetAudience
                });
                
                console.log('Generated description:', description);
                
                const descriptionContent = document.getElementById('descriptionContent');
                const generatedDescription = document.getElementById('generatedDescription');
                
                if (descriptionContent && generatedDescription) {
                    descriptionContent.innerHTML = description;
                    generatedDescription.style.display = 'block';
                    console.log('Description displayed successfully');
                } else {
                    console.error('Could not find description elements');
                    alert('Error: Could not find description elements. Please try again.');
                }
            } catch (error) {
                console.error('Error generating description:', error);
                alert('Error generating description. Please try again.');
            } finally {
                // Reset button
                generateBtn.innerHTML = originalText;
                generateBtn.disabled = false;
            }
        }
        
        function generateAIFormDescription(data) {
            const { craftName, craftType, materials, techniques, culturalStory, timeInvested, specialFeatures, targetAudience } = data;
            
            let description = `<div style="font-size: 1.1rem; font-weight: 600; color: var(--primary-teal); margin-bottom: 1rem;">${craftName}</div>`;
            
            description += `<div style="margin-bottom: 1rem;">`;
            description += `<strong>âœ¨ Craft Type:</strong> ${craftType.charAt(0).toUpperCase() + craftType.slice(1)}<br>`;
            description += `<strong>ðŸŽ¨ Materials:</strong> ${materials}<br>`;
            if (techniques) description += `<strong>ðŸ”§ Techniques:</strong> ${techniques}<br>`;
            if (timeInvested) description += `<strong>â° Time Invested:</strong> ${timeInvested}<br>`;
            if (specialFeatures) description += `<strong>ðŸŒŸ Special Features:</strong> ${specialFeatures}<br>`;
            description += `</div>`;
            
            description += `<div style="margin-bottom: 1rem; line-height: 1.6;">`;
            description += `This exquisite ${craftType} showcases the finest ${materials.toLowerCase()}, `;
            if (techniques) description += `crafted using traditional ${techniques.toLowerCase()}, `;
            description += `representing the rich heritage of Indian craftsmanship. `;
            
            if (culturalStory) {
                description += `${culturalStory} `;
            }
            
            if (timeInvested) {
                description += `Each piece requires ${timeInvested} of dedicated work, `;
            }
            description += `making it a truly special and authentic creation.`;
            
            if (specialFeatures) {
                description += ` ${specialFeatures}, adding to its unique character and appeal.`;
            }
            description += `</div>`;
            
            description += `<div style="background: rgba(16, 163, 127, 0.1); padding: 1rem; border-radius: 10px; margin: 1rem 0;">`;
            description += `<strong>ðŸ’¡ Perfect for:</strong> `;
            if (targetAudience) {
                const audienceText = {
                    'collectors': 'art collectors and heritage enthusiasts',
                    'fashion': 'fashion-forward individuals who appreciate traditional craftsmanship',
                    'home': 'home decor enthusiasts seeking authentic pieces',
                    'gifts': 'special occasions and meaningful gift-giving',
                    'tourists': 'visitors looking for authentic Indian souvenirs',
                    'general': 'anyone who values quality craftsmanship and cultural heritage'
                };
                description += audienceText[targetAudience] || 'anyone who appreciates quality craftsmanship';
            } else {
                description += 'anyone who appreciates quality craftsmanship and cultural heritage';
            }
            description += `</div>`;
            
            description += `<div style="font-size: 0.9rem; color: var(--text-light); font-style: italic; margin-top: 1rem;">`;
            description += `This description is AI-generated and can be customized for your specific marketing needs.`;
            description += `</div>`;
            
            return description;
        }
        
        function copyDescription() {
            const descriptionText = document.getElementById('descriptionContent').textContent;
            navigator.clipboard.writeText(descriptionText).then(() => {
                alert('Description copied to clipboard!');
            }).catch(() => {
                alert('Could not copy to clipboard. Please select and copy manually.');
            });
        }
        
        function sendDescriptionToChat() {
            const descriptionText = document.getElementById('descriptionContent').textContent;
            closeManualDescribeModal();
            
            // Add the description to chat
            addMessage('user', `I'd like help with this description: ${descriptionText}`);
            
            // Generate AI response
            setTimeout(() => {
                generateAIResponse(`Please help me improve this craft description: ${descriptionText}`);
            }, 1000);
        }
        
        function closeDescribeModal() {
            const modal = document.getElementById('describeModal');
            if (modal) {
                modal.remove();
            }
        }
        
        function closeDescribeModalOnClick(event) {
            if (event.target.id === 'describeModal') {
                closeDescribeModal();
            }
        }
        
        function closeManualDescribeModal() {
            const modal = document.getElementById('manualDescribeModal');
            if (modal) {
                modal.remove();
            }
        }
        
        function closeManualDescribeModalOnClick(event) {
            if (event.target.id === 'manualDescribeModal') {
                closeManualDescribeModal();
            }
        }
        
        function testDescriptionGeneration() {
            console.log('Testing description generation...');
            
            // Fill in test data
            document.getElementById('craftName').value = 'Test Handwoven Saree';
            document.getElementById('manualCraftType').value = 'textile';
            document.getElementById('manualMaterials').value = 'Pure silk, gold thread';
            document.getElementById('techniques').value = 'Hand weaving, traditional embroidery';
            document.getElementById('culturalStory').value = 'This saree represents generations of traditional craftsmanship';
            document.getElementById('manualTime').value = '2 weeks';
            document.getElementById('specialFeatures').value = 'One-of-a-kind, eco-friendly';
            document.getElementById('targetAudience').value = 'fashion';
            
            // Generate description
            const testData = {
                craftName: 'Test Handwoven Saree',
                craftType: 'textile',
                materials: 'Pure silk, gold thread',
                techniques: 'Hand weaving, traditional embroidery',
                culturalStory: 'This saree represents generations of traditional craftsmanship',
                timeInvested: '2 weeks',
                specialFeatures: 'One-of-a-kind, eco-friendly',
                targetAudience: 'fashion'
            };
            
            const description = generateAIFormDescription(testData);
            console.log('Test description generated:', description);
            
            const descriptionContent = document.getElementById('descriptionContent');
            const generatedDescription = document.getElementById('generatedDescription');
            
            if (descriptionContent && generatedDescription) {
                descriptionContent.innerHTML = description;
                generatedDescription.style.display = 'block';
                console.log('Test description displayed successfully');
            } else {
                console.error('Could not find description elements for test');
                alert('Test failed: Could not find description elements');
            }
        }
        
        // Influencer platform functions
        function selectProduct(productType) {
            alert(`Selected ${productType} for your next campaign! Opening collaboration tools...`);
        }
        
        function openCollaborationHub() {
            alert('ðŸ¤ Opening collaboration hub - connect with verified craftsmen!');
        }
        
        function openTemplates() {
            alert('ðŸŽ¨ Heritage templates loaded - choose from traditional layouts!');
        }
        
        function openAnalytics() {
            alert('ðŸ“Š Analytics dashboard - track your craft content performance!');
        }
        
        function openCampaignManager() {
            alert('ðŸ“… Campaign manager - schedule and organize your heritage content!');
        }
        
        function openStoryMaker() {
            alert('ðŸ“± Story maker - create engaging heritage stories!');
        }
        
        function openReelEditor() {
            alert('ðŸŽ¥ Reel editor - edit and enhance your craft videos!');
        }
        
        // Firebase Email/Password Auth + tiny local fallback for display name
        const AUTH_KEY = 'vylix_auth_v1';
        function getLocalAuth() { try { return JSON.parse(localStorage.getItem(AUTH_KEY) || 'null'); } catch (_) { return null; } }
        function setLocalAuth(obj) { try { localStorage.setItem(AUTH_KEY, JSON.stringify(obj)); } catch (_) {} }
        function clearLocalAuth() { try { localStorage.removeItem(AUTH_KEY); } catch (_) {} }
        
        function showProfile() {
            const overlay = document.getElementById('authOverlay');
            const card = document.getElementById('authCard');
            const modal = document.getElementById('authModal');
            if (!overlay || !card || !modal) return;
            switchAuthTab('login');
            overlay.classList.add('active');
            card.classList.add('active');
            card.style.pointerEvents = 'auto';
            modal.setAttribute('aria-hidden', 'false');
            const err = document.getElementById('authError'); if (err) { err.style.display = 'none'; err.textContent = ''; }
        }

        function closeAuthModal() {
            const overlay = document.getElementById('authOverlay');
            const card = document.getElementById('authCard');
            const modal = document.getElementById('authModal');
            if (!overlay || !card || !modal) return;
            overlay.classList.remove('active');
            card.classList.remove('active');
            card.style.pointerEvents = 'none';
            modal.setAttribute('aria-hidden', 'true');
        }

        function switchAuthTab(tab) {
            const loginTab = document.getElementById('tabLogin');
            const registerTab = document.getElementById('tabRegister');
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');
            const toggle = document.getElementById('authToggle');
            if (!loginTab || !registerTab || !loginForm || !registerForm) return;
            const isLogin = tab === 'login';
            loginTab.classList.toggle('active', isLogin);
            registerTab.classList.toggle('active', !isLogin);
            loginForm.style.display = isLogin ? 'block' : 'none';
            registerForm.style.display = isLogin ? 'none' : 'block';
            const err = document.getElementById('authError'); if (err) { err.style.display = 'none'; err.textContent = ''; }
            if (toggle) {
                toggle.classList.toggle('login', isLogin);
                toggle.classList.toggle('register', !isLogin);
            }
        }

        function showAuthError(msg) {
            const err = document.getElementById('authError');
            if (!err) return;
            err.textContent = msg;
            err.style.display = 'block';
        }

        function validateEmail(email) { return /[^\s@]+@[^\s@]+\.[^\s@]+/.test(email); }

        function togglePassword(inputId, el) {
            const input = document.getElementById(inputId);
            if (!input) return;
            input.type = input.type === 'password' ? 'text' : 'password';
            if (el) el.textContent = input.type === 'password' ? 'ðŸ‘ï¸' : 'ðŸ™ˆ';
        }

        function updatePasswordMeter() {
            const pw = document.getElementById('regPassword')?.value || '';
            const bar = document.getElementById('pwBar');
            if (!bar) return;
            let score = 0;
            if (pw.length >= 6) score++;
            if (/[A-Z]/.test(pw)) score++;
            if (/[0-9]/.test(pw)) score++;
            if (/[^A-Za-z0-9]/.test(pw)) score++;
            const width = [0, 25, 50, 75, 100][score];
            bar.style.width = width + '%';
            bar.style.background = width < 50 ? '#fca5a5' : width < 75 ? '#fde68a' : '#86efac';
        }

        function setLoading(isLoading, which) {
            const btn = which === 'login' ? document.getElementById('loginBtn') : document.getElementById('registerBtn');
            if (!btn) return;
            btn.disabled = !!isLoading;
            if (isLoading) {
                btn.dataset._text = btn.textContent;
                btn.textContent = 'Please waitâ€¦';
            } else if (btn.dataset._text) {
                btn.textContent = btn.dataset._text;
                delete btn.dataset._text;
            }
        }

        function showToast(message, type) {
            const toast = document.getElementById('toast');
            if (!toast) return;
            toast.textContent = message;
            toast.style.display = 'block';
            toast.style.background = type === 'error' ? '#7f1d1d' : type === 'success' ? '#065f46' : '#111827';
            setTimeout(() => { toast.style.display = 'none'; }, 2200);
        }

        function continueGuest() {
            try {
                showToast('Continuing as guest', 'success');
                closeAuthModal();
            } catch (_) {}
        }

        async function oauthSignIn(providerName) {
            const { auth, GoogleAuthProvider, FacebookAuthProvider, signInWithPopup } = window.firebase || {};
            if (!auth || !signInWithPopup) return showAuthError('Firebase not ready.');
            try {
                let provider = null;
                if (providerName === 'google' && GoogleAuthProvider) provider = new GoogleAuthProvider();
                if (providerName === 'facebook' && FacebookAuthProvider) provider = new FacebookAuthProvider();
                if (!provider) return showAuthError('Provider not available.');
                setLoading(true, 'login');
                const result = await signInWithPopup(auth, provider);
                const user = result.user;
                showToast(`Welcome ${user.displayName || user.email || ''}`, 'success');
                updateAuthUI();
                closeAuthModal();
            } catch (err) {
                console.error('OAuth sign-in failed', err);
                showAuthError(err.message || 'Sign-in failed');
                showToast('Sign-in failed', 'error');
            } finally {
                setLoading(false, 'login');
            }
        }

        // Phone Auth helpers
        let _confirmationResult = null;
        let _recaptcha = null;
        function openPhoneAuth() {
            const section = document.getElementById('phoneSection');
            if (!section) return;
            section.style.display = 'block';
            if (!_recaptcha) {
                const { auth, RecaptchaVerifier } = window.firebase || {};
                if (!auth || !RecaptchaVerifier) return showAuthError('Firebase not ready.');
                _recaptcha = new RecaptchaVerifier(auth, 'recaptchaContainer', { size: 'normal' });
            }
        }

        function sendOtp() {
            const phone = document.getElementById('phoneNumber')?.value.trim();
            const { auth, signInWithPhoneNumber } = window.firebase || {};
            if (!auth || !signInWithPhoneNumber) return showAuthError('Firebase not ready.');
            if (!phone) return showAuthError('Enter a valid phone number with country code.');
            setLoading(true, 'login');
            signInWithPhoneNumber(auth, phone, _recaptcha)
                .then((c) => {
                    _confirmationResult = c;
                    document.getElementById('otpRow').style.display = 'block';
                    showToast('OTP sent', 'success');
                })
                .catch(err => { console.error('OTP send failed', err); showAuthError(err.message || 'OTP send failed'); showToast('OTP send failed', 'error'); })
                .finally(() => setLoading(false, 'login'));
        }

        function verifyOtp() {
            const code = document.getElementById('otpCode')?.value.trim();
            if (!_confirmationResult) return showAuthError('Please request an OTP first.');
            if (!code) return showAuthError('Enter the OTP code.');
            setLoading(true, 'login');
            _confirmationResult.confirm(code)
                .then(() => { updateAuthUI(); closeAuthModal(); showToast('Phone verified', 'success'); })
                .catch(err => { console.error('OTP verify failed', err); showAuthError(err.message || 'OTP verify failed'); showToast('OTP verify failed', 'error'); })
                .finally(() => setLoading(false, 'login'));
        }

        function submitLogin() {
            const email = document.getElementById('loginEmail')?.value.trim();
            const password = document.getElementById('loginPassword')?.value;
            if (!email || !password) return showAuthError('Please fill all fields.');
            if (!validateEmail(email)) return showAuthError('Enter a valid email.');
            if (password.length < 6) return showAuthError('Password must be at least 6 characters.');
            const { auth, signInWithEmailAndPassword } = window.firebase || {};
            if (!auth || !signInWithEmailAndPassword) return showAuthError('Firebase not ready.');
            setLoading(true, 'login');
            signInWithEmailAndPassword(auth, email, password)
                .then(() => { updateAuthUI(); closeAuthModal(); showToast('Signed in successfully', 'success'); })
                .catch(err => { console.error('Login failed', err); showAuthError(err.message || 'Login failed'); showToast('Login failed', 'error'); })
                .finally(() => setLoading(false, 'login'));
        }

        function submitRegister() {
            const name = document.getElementById('regName')?.value.trim();
            const email = document.getElementById('regEmail')?.value.trim();
            const password = document.getElementById('regPassword')?.value;
            const confirm = document.getElementById('regConfirm')?.value;
            if (!name || !email || !password || !confirm) return showAuthError('Please fill all fields.');
            if (!validateEmail(email)) return showAuthError('Enter a valid email.');
            if (password.length < 6) return showAuthError('Password must be at least 6 characters.');
            if (password !== confirm) return showAuthError('Passwords do not match.');
            const { auth, createUserWithEmailAndPassword, updateProfile } = window.firebase || {};
            if (!auth || !createUserWithEmailAndPassword || !updateProfile) return showAuthError('Firebase not ready.');
            setLoading(true, 'register');
            createUserWithEmailAndPassword(auth, email, password)
                .then(async (cred) => {
                    try { await updateProfile(cred.user, { displayName: name }); } catch (_) {}
                    setLocalAuth({ name, email });
                    updateAuthUI();
                    closeAuthModal();
                    showToast('Account created', 'success');
                })
                .catch(err => { console.error('Registration failed', err); showAuthError(err.message || 'Registration failed'); showToast('Registration failed', 'error'); })
                .finally(() => setLoading(false, 'register'));
        }

        function updateAuthUI() {
            const entry = document.getElementById('profileEntry');
            const user = (window.firebase && window.firebase.auth && window.firebase.auth.currentUser) || null;
            if (!entry) return;
            if (user) {
                const short = (user.displayName || user.email || 'User');
                entry.textContent = `ðŸ‘¤ ${short} (Sign out)`;
                entry.onclick = function() { signOut(); };
            } else {
                entry.textContent = 'ðŸ‘¤ Sign in / Register';
                entry.onclick = function() { showProfile(); };
            }
        }

        function toggleAuthMode() {
            const loginVisible = document.getElementById('loginForm')?.style.display !== 'none';
            switchAuthTab(loginVisible ? 'register' : 'login');
        }

        function signOut() {
            const { auth, fbSignOut } = window.firebase || {};
            if (auth && fbSignOut) {
                fbSignOut(auth).then(() => { updateAuthUI(); }).catch(() => { updateAuthUI(); });
            } else {
                clearLocalAuth();
                updateAuthUI();
            }
        }

        document.addEventListener('DOMContentLoaded', updateAuthUI);
        // Offline/online banner
        window.addEventListener('offline', () => { const b = document.getElementById('offlineBanner'); if (b) b.style.display = 'block'; showToast('You are offline', 'error'); });
        window.addEventListener('online', () => { const b = document.getElementById('offlineBanner'); if (b) b.style.display = 'none'; showToast('Back online', 'success'); });
        if (!navigator.onLine) { const b = document.getElementById('offlineBanner'); if (b) b.style.display = 'block'; }
        
        // Chat Management Functions
        function startNewChat() {
            // Clear current chat
            chatMessages = [];
            currentChatId = null;
            
            // Clear messages display
            const messagesContainer = document.getElementById('chatMessages');
            messagesContainer.innerHTML = `
                <div class="message ai">
                    <div class="message-avatar">ðŸ¤–</div>
                    <div class="message-content">
                        Hello! I'm Vylix AI powered by Google Gemini! ðŸŒŸ I can help you create compelling craft descriptions, suggest marketing strategies, and provide insights about traditional Indian artistry. What would you like to work on today?
                    </div>
                </div>
            `;
            
            // Add initial AI message to chat history
            chatMessages.push({
                sender: 'ai',
                content: "Hello! I'm Vylix AI powered by Google Gemini! ðŸŒŸ I can help you create compelling craft descriptions, suggest marketing strategies, and provide insights about traditional Indian artistry. What would you like to work on today?",
                timestamp: new Date().toISOString()
            });
            
            // Hide save button
            document.getElementById('saveChatBtn').style.display = 'none';
            
            // Update chat title
            document.querySelector('.chat-title').innerHTML = `
                Craft Description Assistant 
                <span style="font-size: 0.8rem; margin-left: 1rem; padding: 0.2rem 0.6rem; border-radius: 12px; background: #d4edda; color: #155724; font-weight: 600;">
                    ðŸ¤– Gemini AI Active
                </span>
            `;
        }
        
        async function saveCurrentChat() {
            console.log('Saving chat with messages:', chatMessages);
            
            if (chatMessages.length === 0) {
                alert('No messages to save! Start a conversation first.');
                return;
            }
            
            // Generate chat title from first user message
            const firstUserMessage = chatMessages.find(msg => msg.sender === 'user');
            const chatTitle = firstUserMessage ? 
                firstUserMessage.content.substring(0, 50) + (firstUserMessage.content.length > 50 ? '...' : '') :
                'New Chat';
            
            console.log('Chat title:', chatTitle);
            
            const chatData = {
                id: currentChatId || Date.now().toString(),
                title: chatTitle,
                messages: [...chatMessages],
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            console.log('Chat data to save:', chatData);
            
            // Try to save to Firebase first
            const firebaseSuccess = await saveChatToFirebase(chatData);
            
            if (firebaseSuccess) {
                // Update local array for UI
                const existingIndex = savedChats.findIndex(chat => chat.id === currentChatId);
                if (existingIndex >= 0) {
                    savedChats[existingIndex] = chatData;
                } else {
                    savedChats.unshift(chatData);
                }
            } else {
                // Fallback to localStorage
                const existingIndex = savedChats.findIndex(chat => chat.id === currentChatId);
                if (existingIndex >= 0) {
                    savedChats[existingIndex] = chatData;
                    console.log('Updated existing chat at index:', existingIndex);
                } else {
                    savedChats.unshift(chatData);
                    currentChatId = chatData.id;
                    console.log('Added new chat with ID:', currentChatId);
                }
                
                localStorage.setItem('vylixChats', JSON.stringify(savedChats));
                console.log('Saved to localStorage. Total chats:', savedChats.length);
            }
            
            // Update sidebar
            loadChatHistory();
            
            // Show success message
            const saveBtn = document.getElementById('saveChatBtn');
            const originalText = saveBtn.innerHTML;
            saveBtn.innerHTML = firebaseSuccess ? 'âœ… Saved to Cloud!' : 'âœ… Saved Locally!';
            saveBtn.style.background = 'linear-gradient(135deg, #28a745, #20c997)';
            
            setTimeout(() => {
                saveBtn.innerHTML = originalText;
                saveBtn.style.background = '';
            }, 2000);
        }
        
        function loadChatHistory() {
            const chatHistory = document.getElementById('chatHistory');
            chatHistory.innerHTML = '';
            
            if (savedChats.length === 0) {
                chatHistory.innerHTML = '<div style="padding: 1rem; text-align: center; color: var(--text-light); font-size: 0.9rem;">No saved chats yet</div>';
                return;
            }
            
            savedChats.forEach(chat => {
                const chatItem = document.createElement('div');
                chatItem.className = 'chat-history-item';
                chatItem.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="flex: 1; overflow: hidden;">
                            <div style="font-weight: 600; color: var(--text-dark); margin-bottom: 0.2rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${chat.title}</div>
                            <div style="font-size: 0.8rem; color: var(--text-light);">${new Date(chat.updatedAt).toLocaleDateString()}</div>
                        </div>
                        <div style="display: flex; gap: 0.3rem; margin-left: 0.5rem;">
                            <button onclick="loadChat('${chat.id}')" style="background: none; border: none; color: var(--primary-teal); cursor: pointer; font-size: 0.8rem; padding: 0.2rem;" title="Load Chat">ðŸ“‚</button>
                            <button onclick="deleteChat('${chat.id}')" style="background: none; border: none; color: var(--secondary-red); cursor: pointer; font-size: 0.8rem; padding: 0.2rem;" title="Delete Chat">ðŸ—‘ï¸</button>
                        </div>
                    </div>
                `;
                chatHistory.appendChild(chatItem);
            });
        }
        
        function loadChat(chatId) {
            console.log('Loading chat with ID:', chatId);
            console.log('Available chats:', savedChats);
            
            const chat = savedChats.find(c => c.id === chatId);
            if (!chat) {
                console.error('Chat not found with ID:', chatId);
                alert('Chat not found! It may have been deleted.');
                return;
            }
            
            console.log('Found chat:', chat);
            console.log('Chat messages:', chat.messages);
            
            // Set current chat
            currentChatId = chatId;
            chatMessages = [...chat.messages];
            
            // Clear and reload messages
            const messagesContainer = document.getElementById('chatMessages');
            if (!messagesContainer) {
                console.error('Messages container not found!');
                return;
            }
            
            messagesContainer.innerHTML = '';
            
            chat.messages.forEach((msg, index) => {
                console.log(`Loading message ${index}:`, msg);
                
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${msg.sender}`;
                
                const avatar = msg.sender === 'user' ? 'ðŸ‘¤' : 'ðŸ¤–';
                // Don't enhance AI responses when loading - they're already enhanced
                const content = msg.content;
                
                messageDiv.innerHTML = `
                    <div class="message-avatar">${avatar}</div>
                    <div class="message-content">${content}</div>
                `;
                
                messagesContainer.appendChild(messageDiv);
            });
            
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            // Show save button
            const saveBtn = document.getElementById('saveChatBtn');
            if (saveBtn) {
                saveBtn.style.display = 'block';
            }
            
            // Update chat title
            const chatTitle = document.querySelector('.chat-title');
            if (chatTitle) {
                chatTitle.innerHTML = `
                    ${chat.title}
                    <span style="font-size: 0.8rem; margin-left: 1rem; padding: 0.2rem 0.6rem; border-radius: 12px; background: #d4edda; color: #155724; font-weight: 600;">
                        ðŸ¤– Gemini AI Active
                    </span>
                `;
            }
            
            console.log('Chat loaded successfully!');
        }
        
        async function deleteChat(chatId) {
            if (confirm('Are you sure you want to delete this chat?')) {
                // Try to delete from Firebase first
                const firebaseSuccess = await deleteChatFromFirebase(chatId);
                
                // Remove from local array
                savedChats = savedChats.filter(chat => chat.id !== chatId);
                
                // Update localStorage as fallback
                localStorage.setItem('vylixChats', JSON.stringify(savedChats));
                
                // Update UI
                loadChatHistory();
                
                // If this was the current chat, start a new one
                if (currentChatId === chatId) {
                    startNewChat();
                }
                
                console.log(firebaseSuccess ? 'âœ… Chat deleted from Firebase' : 'âš ï¸ Chat deleted locally only');
            }
        }
        
        function clearAllChats() {
            if (confirm('Are you sure you want to delete ALL saved chats? This cannot be undone.')) {
                savedChats = [];
                localStorage.removeItem('vylixChats');
                loadChatHistory();
                startNewChat();
            }
        }
        
        // Image Upload and Analysis Functions
        let uploadedImageData = null;
        
        // Cloudinary unsigned upload for image uploads
        // Configure these in your Cloudinary dashboard
        const CLOUDINARY_CLOUD_NAME = 'donctlcuj';
        const CLOUDINARY_UPLOAD_PRESET = 'vylix_unsigned';
        const CLOUDINARY_UPLOAD_URL = `https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/image/upload`;
        
        async function uploadImageToCloudinary(file) {
            try {
                const formData = new FormData();
                formData.append('file', file);
                formData.append('upload_preset', CLOUDINARY_UPLOAD_PRESET);
                
                const res = await fetch(CLOUDINARY_UPLOAD_URL, {
                    method: 'POST',
                    body: formData
                });
                if (!res.ok) throw new Error('Cloudinary upload failed');
                const data = await res.json();
                return data.secure_url;
            } catch (err) {
                console.error('âŒ Cloudinary upload error:', err);
                return null;
            }
        }
        
        async function handleImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // Validate file type
            if (!file.type.startsWith('image/')) {
                alert('Please select a valid image file!');
                return;
            }
            
            // Validate file size (max 10MB)
            if (file.size > 10 * 1024 * 1024) {
                alert('Image size must be less than 10MB!');
                return;
            }
            
            // Show loading message
            addMessage('ai', '', true);
            
            try {
                // Convert to base64 for AI analysis (always needed)
                const base64 = await convertToBase64(file);
                uploadedImageData = base64;
                
                // Try to upload to Cloudinary for storage (optional)
                const cloudUrl = await uploadImageToCloudinary(file);
                if (cloudUrl) {
                    console.log('âœ… Image also saved to Cloudinary:', cloudUrl);
                }
                
                // Use base64 for AI analysis
                await analyzeImageWithAI(base64, file.name);
                
            } catch (error) {
                console.error('Image upload error:', error);
                // Remove loading message and show error
                const messagesContainer = document.getElementById('chatMessages');
                messagesContainer.removeChild(messagesContainer.lastChild);
                addMessage('ai', 'âŒ Sorry, there was an error analyzing your image. Please try again.');
            }
        }
        
        function convertToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }
        
        async function analyzeImageWithAI(imageData, fileName) {
            try {
                // Remove loading message
                const messagesContainer = document.getElementById('chatMessages');
                messagesContainer.removeChild(messagesContainer.lastChild);
                
                // Show image preview and analysis
                const analysisHTML = createImageAnalysisHTML(imageData, fileName);
                addMessage('ai', analysisHTML);
                
                // Get AI analysis using Gemini Vision
                const analysisResult = await getGeminiVisionAnalysis(imageData);
                
                // Update the analysis with real AI data
                updateImageAnalysis(analysisResult);
                
            } catch (error) {
                console.error('Image analysis error:', error);
                // Show fallback analysis
                const fallbackHTML = createFallbackImageAnalysis(imageData, fileName);
                const messagesContainer = document.getElementById('chatMessages');
                messagesContainer.removeChild(messagesContainer.lastChild);
                addMessage('ai', fallbackHTML);
            }
        }
        
        function createImageAnalysisHTML(imageData, fileName) {
            return `
                <div class="image-preview-container">
                    <div class="image-analysis-header">
                        ðŸ” AI Image Analysis
                    </div>
                    <img src="${imageData}" alt="Uploaded craft" class="uploaded-image">
                    <div class="image-loading">
                        <div class="loading-spinner"></div>
                        Analyzing your craft image...
                    </div>
                </div>
            `;
        }
        
        function createFallbackImageAnalysis(imageData, fileName) {
            return `
                <div class="image-preview-container">
                    <div class="image-analysis-header">
                        ðŸ“¸ Your Craft Image
                    </div>
                    <img src="${imageData}" alt="Uploaded craft" class="uploaded-image">
                    <div class="analysis-grid">
                        <div class="analysis-card">
                            <div class="analysis-card-title">ðŸŽ¨ Craft Type</div>
                            <div class="analysis-card-content">
                                Based on the image, this appears to be a beautiful handmade craft. 
                                The AI can help you create compelling descriptions for marketing.
                            </div>
                            <div class="confidence-bar">
                                <div class="confidence-fill" style="width: 85%"></div>
                            </div>
                            <div class="confidence-text">85% confidence</div>
                        </div>
                        <div class="analysis-card">
                            <div class="analysis-card-title">ðŸ’¡ Marketing Suggestions</div>
                            <div class="analysis-card-content">
                                â€¢ Highlight the handcrafted quality<br>
                                â€¢ Showcase unique details<br>
                                â€¢ Create lifestyle content<br>
                                â€¢ Use natural lighting
                            </div>
                        </div>
                        <div class="analysis-card">
                            <div class="analysis-card-title">ðŸ“± Social Media Tips</div>
                            <div class="analysis-card-content">
                                â€¢ Use hashtags: #handmade #craft #artisan<br>
                                â€¢ Show behind-the-scenes process<br>
                                â€¢ Create before/after content<br>
                                â€¢ Tag relevant accounts
                            </div>
                        </div>
                    </div>
                    <div class="highlight-box">
                        <strong>ðŸ’¡ Pro Tip:</strong> Upload higher quality images for better AI analysis! 
                        Try different angles and lighting to showcase your craft's best features.
                    </div>
                </div>
            `;
        }
        
        async function getGeminiVisionAnalysis(imageData) {
            try {
                // Use Gemini Vision API for image analysis
                const response = await fetch(`${GEMINI_API_URL}?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [
                                {
                                    text: `Analyze this craft image and provide detailed insights for marketing and sales. Focus on:
                                    1. Craft type and materials
                                    2. Quality and craftsmanship details
                                    3. Marketing angles and selling points
                                    4. Target audience suggestions
                                    5. Photography and presentation tips
                                    
                                    Be specific and actionable for a craftsperson trying to sell their work.`
                                },
                                {
                                    inline_data: {
                                        mime_type: "image/jpeg",
                                        data: imageData.split(',')[1]
                                    }
                                }
                            ]
                        }]
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`Vision API error: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.candidates && data.candidates[0] && data.candidates[0].content) {
                    return data.candidates[0].content.parts[0].text;
                } else {
                    throw new Error('Invalid vision API response');
                }
                
            } catch (error) {
                console.error('Gemini Vision API error:', error);
                throw error;
            }
        }
        
        function updateImageAnalysis(analysisText) {
            // Find the loading message and replace with real analysis
            const messagesContainer = document.getElementById('chatMessages');
            const lastMessage = messagesContainer.lastChild;
            const messageContent = lastMessage.querySelector('.message-content');
            
            if (messageContent && messageContent.innerHTML.includes('loading-spinner')) {
                messageContent.innerHTML = `
                    <div class="image-preview-container">
                        <div class="image-analysis-header">
                            ðŸ” AI Image Analysis Complete
                        </div>
                        <img src="${uploadedImageData}" alt="Uploaded craft" class="uploaded-image">
                        <div class="response-paragraph">
                            ${analysisText}
                        </div>
                        <div class="highlight-box">
                            <strong>âœ¨ AI Insights:</strong> This analysis is powered by Google Gemini Vision AI. 
                            Use these insights to create compelling product descriptions and marketing content!
                        </div>
                    </div>
                `;
            }
        }
        
        

        // Enter key support for chat
        document.addEventListener('DOMContentLoaded', function() {
            const chatInput = document.getElementById('chatInput');
            if (chatInput) {
                chatInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        sendMessage();
                    }
                });
            }
            
            
            // Load saved chats
            loadChatHistory();
            
            // API key is hardcoded and ready to use
            console.log('âœ… Gemini AI is ready and active!');
            
            // Preload images
            const imageUrls = [
                'https://images.pexels.com/photos/8886950/pexels-photo-8886950.jpeg',
                'https://images.pexels.com/photos/318238/pexels-photo-318238.jpeg',
                'https://images.pexels.com/photos/7575039/pexels-photo-7575039.jpeg',
                'https://images.pexels.com/photos/31102565/pexels-photo-31102565.jpeg'
            ];
            
            imageUrls.forEach(url => {
                const img = new Image();
                img.src = url;
            });
        });
        
        // Parallax effect
        document.addEventListener('mousemove', function(e) {
            const mouseX = e.clientX / window.innerWidth;
            const mouseY = e.clientY / window.innerHeight;
            
            bgImages.forEach(img => {
                const translateX = (mouseX - 0.5) * 20;
                const translateY = (mouseY - 0.5) * 20;
                img.style.transform = `translate(${translateX}px, ${translateY}px) scale(1.1)`;
            });
        });

        // Modern Voice Feature Implementation
        class VoiceAssistant {
            constructor() {
                this.isRecording = false;
                this.recognition = null;
                this.isSupported = false;
                this.collectedTranscript = ''; // Store all speech during recording
                this.countdownTimer = null;
                this.timeRemaining = 30;
                this.commands = {
                    'generate description': () => this.handleGenerateDescription(),
                    'save product': () => this.handleSaveProduct(),
                    'clear chat': () => this.handleClearChat(),
                    'help': () => this.showCommandHint(),
                    'start recording': () => this.startRecording(),
                    'stop recording': () => this.stopRecording(),
                    'ask ai': () => this.handleAskAI(),
                    'what can you do': () => this.handleWhatCanYouDo(),
                    'tell me about': () => this.handleTellMeAbout()
                };
                
                this.init();
            }

            init() {
                this.checkSupport();
                this.setupEventListeners();
                this.showInitialHint();
            }

            checkSupport() {
                this.isSupported = 'webkitSpeechRecognition' in window || 'SpeechRecognition' in window;
                
                if (!this.isSupported) {
                    this.hideVoiceButton();
                    console.warn('Speech recognition not supported in this browser');
            } else {
                    // Test microphone access
                    this.testMicrophoneAccess();
                }
            }

            async testMicrophoneAccess() {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    console.log('âœ… Microphone access granted');
                    stream.getTracks().forEach(track => track.stop()); // Stop the test stream
                } catch (error) {
                    console.error('âŒ Microphone access denied:', error);
                    this.showStatus('âŒ Microphone access denied. Please allow microphone access.', 'error');
                }
            }

            hideVoiceButton() {
                const voiceBtn = document.getElementById('voiceBtn');
                if (voiceBtn) {
                    voiceBtn.style.display = 'none';
                }
            }

            setupEventListeners() {
                // Show command hint on long press
                let longPressTimer;
                const voiceBtn = document.getElementById('voiceBtn');
                
                if (voiceBtn) {
                    voiceBtn.addEventListener('mousedown', () => {
                        longPressTimer = setTimeout(() => {
                            this.showCommandHint();
                        }, 1000);
                    });
                    
                    voiceBtn.addEventListener('mouseup', () => {
                        clearTimeout(longPressTimer);
                    });
                    
                    voiceBtn.addEventListener('mouseleave', () => {
                        clearTimeout(longPressTimer);
                    });
                }
            }

            showInitialHint() {
                setTimeout(() => {
                    if (this.isSupported) {
                        this.showStatus('Try saying "Generate description" or "Help"');
                    } else {
                        this.showStatus('Voice not supported - use text input instead');
                    }
                }, 2000);
            }

            // Simple voice test function
            testVoiceRecognition() {
                this.showStatus('ðŸ§ª Testing voice recognition...', 'info');
                
                try {
                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    const testRecognition = new SpeechRecognition();
                    
                    testRecognition.continuous = false;
                    testRecognition.interimResults = false;
                    testRecognition.lang = 'en-US';
                    
                    testRecognition.onstart = () => {
                        this.showStatus('ðŸŽ¤ Test: Listening for any speech...', 'info');
                    };
                    
                    testRecognition.onresult = (event) => {
                        const transcript = event.results[0][0].transcript;
                        this.showStatus(`âœ… Test successful! Heard: "${transcript}"`, 'success');
                        console.log('Voice test successful:', transcript);
                    };
                    
                    testRecognition.onerror = (event) => {
                        this.showStatus(`âŒ Test failed: ${event.error}`, 'error');
                        console.error('Voice test failed:', event.error);
                    };
                    
                    testRecognition.onend = () => {
                        this.showStatus('Test completed', 'info');
                    };
                    
                    testRecognition.start();
                } catch (error) {
                    this.showStatus('âŒ Test failed to start', 'error');
                    console.error('Voice test error:', error);
                }
            }

            toggleVoiceRecording() {
                if (!this.isSupported) {
                    this.showStatus('Voice not supported in this browser', 'error');
                    return;
                }

                if (this.isRecording) {
                    this.stopRecording();
            } else {
                    this.startRecording();
                }
            }

            startRecording() {
                if (this.isRecording) return;

                // Check network connectivity first
                if (!navigator.onLine) {
                    this.showStatus('âŒ No internet connection. Voice requires online access.', 'error');
                    return;
                }

                try {
                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    this.recognition = new SpeechRecognition();
                    
                    // Improved configuration for better voice detection
                    this.recognition.continuous = true; // Keep listening
                    this.recognition.interimResults = true;
                    this.recognition.lang = 'en-US';
                    this.recognition.maxAlternatives = 3; // Get more alternatives
                    this.recognition.serviceURI = ''; // Use default service

                    // Add timeout to give user 30 seconds to speak
                    const timeout = setTimeout(() => {
                        if (this.isRecording) {
                            this.showStatus('â° 30 seconds up! Processing your speech...', 'info');
                            this.stopRecording();
                        }
                    }, 30000); // 30 second timeout

                    this.recognition.onstart = () => {
                        this.isRecording = true;
                        this.updateUI('recording');
                        this.showWaveform();
                        this.showStopButton();
                        this.collectedTranscript = ''; // Reset collected transcript
                        this.showStatus('ðŸŽ¤ Listening... You have 30 seconds to speak!');
                        this.startCountdown();
                        console.log('Voice recognition started successfully');
                    };

                    this.recognition.onresult = (event) => {
                        let finalTranscript = '';
                        let interimTranscript = '';

                        for (let i = event.resultIndex; i < event.results.length; i++) {
                            const transcript = event.results[i][0].transcript;
                            const confidence = event.results[i][0].confidence;
                            
                            console.log(`Voice result: "${transcript}" (confidence: ${confidence})`);
                            
                            if (event.results[i].isFinal) {
                                finalTranscript += transcript;
                                // Add to collected transcript
                                this.collectedTranscript += transcript + ' ';
                            } else {
                                interimTranscript += transcript;
                            }
                        }

                        if (finalTranscript) {
                            console.log('Final transcript:', finalTranscript);
                            // Don't process immediately, just collect
                        } else if (interimTranscript) {
                            this.showStatus(`ðŸŽ¤ ${interimTranscript}...`);
                        }
                    };

                    this.recognition.onerror = (event) => {
                        clearTimeout(timeout);
                        console.error('Speech recognition error:', event.error);
                        this.handleError(event.error);
                    };

                    this.recognition.onend = () => {
                        clearTimeout(timeout);
                        console.log('Voice recognition ended');
                        this.stopRecording();
                    };

                    this.recognition.onnomatch = () => {
                        console.log('No speech was recognized');
                        this.showStatus('ðŸ”‡ No speech detected. Please speak louder.', 'error');
                    };

                    this.recognition.onspeechstart = () => {
                        console.log('Speech started');
                        this.showStatus('ðŸ—£ï¸ Speech detected! Keep speaking...');
                    };

                    this.recognition.onspeechend = () => {
                        console.log('Speech ended');
                        this.showStatus('âœ… Processing speech...');
                    };

                    this.recognition.start();
                } catch (error) {
                    console.error('Error starting speech recognition:', error);
                    this.showStatus('âŒ Error starting microphone. Please check permissions.', 'error');
                }
            }

            stopRecording() {
                this.isRecording = false;
                this.updateUI('idle');
                this.hideWaveform();
                this.hideStopButton();
                this.stopCountdown();
                
                if (this.recognition) {
                    this.recognition.stop();
                }
                
                // Process the collected transcript after a short delay
                setTimeout(() => {
                    this.processCollectedTranscript();
                }, 500);
            }

            processCollectedTranscript() {
                const transcript = this.collectedTranscript.trim();
                
                if (transcript && transcript.length > 0) {
                    console.log('Processing collected transcript:', transcript);
                    this.showStatus(`ðŸŽ¯ Processing: "${transcript}"`);
                    this.processVoiceCommand(transcript);
                } else {
                    this.showStatus('ðŸ”‡ No speech detected. Please try speaking again.', 'error');
                }
            }

            processVoiceCommand(transcript) {
                const command = transcript.toLowerCase();
                this.showStatus(`ðŸŽ¯ Processing: "${transcript}"`);
                
                // Check for exact command matches first
                for (const [cmd, handler] of Object.entries(this.commands)) {
                    if (command.includes(cmd)) {
                        handler();
                        return;
                    }
                }

                // If no command matched, send to AI chat
                this.sendToAIChat(transcript);
            }

            sendToAIChat(transcript) {
                this.showStatus('ðŸ¤– Sending to AI...', 'info');
                this.updateUI('processing');
                
                // Add the voice message to chat
                this.addVoiceMessageToChat(transcript);
                
                // Send to AI and get response
                this.getAIResponse(transcript);
            }

            addVoiceMessageToChat(message) {
                const chatMessages = document.querySelector('.chat-messages');
                if (chatMessages) {
                    const messageDiv = document.createElement('div');
                    messageDiv.className = 'message user-message';
                    messageDiv.innerHTML = `
                        <div class="message-content">
                            <div class="message-text">${message}</div>
                            <div class="message-meta">
                                <span class="message-time">${new Date().toLocaleTimeString()}</span>
                                <span class="voice-indicator">ðŸŽ¤ Voice</span>
                            </div>
                        </div>
                    `;
                    chatMessages.appendChild(messageDiv);
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }
            }

            async getAIResponse(userMessage) {
                try {
                    // Use the existing AI system
                    const response = await this.callGeminiAI(userMessage);
                    
                    // Add AI response to chat
                    this.addAIResponseToChat(response);
                    
                    this.showStatus('âœ… AI response generated!', 'success');
                    this.updateUI('idle');
                    
                } catch (error) {
                    console.error('Error getting AI response:', error);
                    
                    // Provide a fallback response
                    const fallbackResponse = this.getFallbackResponse(userMessage);
                    this.addAIResponseToChat(fallbackResponse);
                    
                    this.showStatus('âš ï¸ Using fallback response (API error)', 'error');
                    this.updateUI('idle');
                }
            }

            getFallbackResponse(message) {
                const lowerMessage = message.toLowerCase();
                
                if (lowerMessage.includes('description') || lowerMessage.includes('describe')) {
                    return "I'd be happy to help you create a product description! For now, I can suggest focusing on: materials used, traditional techniques, cultural significance, dimensions, and care instructions. Please try the voice feature again or use the text chat for more detailed assistance.";
                } else if (lowerMessage.includes('price') || lowerMessage.includes('cost')) {
                    return "For pricing your crafts, consider: material costs, time invested, skill level, market demand, and competitor pricing. A good rule is to calculate your costs and add a fair profit margin. Would you like more specific pricing advice?";
                } else if (lowerMessage.includes('help') || lowerMessage.includes('what can you do')) {
                    return "I can help you with product descriptions, pricing strategies, marketing tips, craft techniques, and general business advice for your Vylix platform. Just ask me anything about your crafts or business!";
                } else {
                    return `I heard you say: "${message}". I'm here to help with your crafts and business on Vylix! I can assist with product descriptions, pricing, marketing, and more. Please try asking me something specific about your crafts or business.`;
                }
            }

            addAIResponseToChat(response) {
                const chatMessages = document.querySelector('.chat-messages');
                if (chatMessages) {
                    const messageDiv = document.createElement('div');
                    messageDiv.className = 'message ai-message';
                    messageDiv.innerHTML = `
                        <div class="message-content">
                            <div class="message-text">${response}</div>
                            <div class="message-meta">
                                <span class="message-time">${new Date().toLocaleTimeString()}</span>
                                <span class="ai-indicator">ðŸ¤– AI</span>
                            </div>
                        </div>
                    `;
                    chatMessages.appendChild(messageDiv);
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }
            }

            async callGeminiAI(message) {
                // Use the new API key specifically for voice interactions
                const GEMINI_API_KEY = 'AIzaSyAhqL8ipsPvSVDrxa8lTldfbbnC083N6ZM'; // Voice-specific API key
                const GEMINI_API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent';
                
                // Build context from chat history
                const chatMessages = document.querySelectorAll('.message');
                let chatHistory = '';
                chatMessages.forEach(msg => {
                    const text = msg.querySelector('.message-text')?.textContent || '';
                    const isUser = msg.classList.contains('user-message');
                    chatHistory += `${isUser ? 'User' : 'Assistant'}: ${text}\n`;
                });
                
                const requestBody = {
                    contents: [{
                        parts: [{
                            text: `You are a helpful assistant for Vylix, a platform for Indian craftsmen and artisans. 

Previous conversation:
${chatHistory}

Current user message: "${message}"

Please provide a helpful response related to crafts, products, descriptions, or general assistance. Be conversational and helpful.`
                        }]
                    }],
                    generationConfig: {
                        temperature: 0.7,
                        topK: 40,
                        topP: 0.95,
                        maxOutputTokens: 1024,
                    }
                };

                console.log('ðŸš€ Calling Gemini API for voice...');
                console.log('API Key:', GEMINI_API_KEY.substring(0, 10) + '...');
                console.log('Message:', message);

                const response = await fetch(`${GEMINI_API_URL}?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestBody)
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('API Error Response:', errorText);
                    throw new Error(`AI API error: ${response.status} - ${errorText}`);
                }

                const data = await response.json();
                console.log('âœ… Gemini API response received');
                return data.candidates[0].content.parts[0].text;
            }

            handleTextInput(text) {
                // Insert text into chat input if available
                const chatInput = document.getElementById('chatInput');
                if (chatInput) {
                    chatInput.value = text;
                    chatInput.focus();
                    this.showStatus('âœ… Text inserted into chat');
                } else {
                    this.showStatus('âœ… Voice input received');
                }
            }

            handleGenerateDescription() {
                this.showStatus('ðŸ¤– Generating AI description...');
                // Trigger the existing description generation
                if (typeof startManualDescription === 'function') {
                    startManualDescription();
                }
            }

            handleSaveProduct() {
                this.showStatus('ðŸ’¾ Saving product...');
                // Add save functionality here
                showToast('Product saved successfully!', 'success');
            }

            handleClearChat() {
                this.showStatus('ðŸ—‘ï¸ Clearing chat...');
                const chatMessages = document.querySelector('.chat-messages');
                if (chatMessages) {
                    chatMessages.innerHTML = '';
                }
                showToast('Chat cleared!', 'success');
            }

            handleAskAI() {
                this.showStatus('ðŸ¤– Ask me anything about crafts, products, or Vylix!');
                // This will be handled by the general voice processing
            }

            handleWhatCanYouDo() {
                const capabilities = "I can help you with craft descriptions, product information, AI-generated content, and general assistance with the Vylix platform. Just speak naturally and I'll understand!";
                this.addAIResponseToChat(capabilities);
                this.showStatus('âœ… Here\'s what I can do!', 'success');
            }

            handleTellMeAbout() {
                this.showStatus('ðŸ¤– Tell me what you\'d like to know about!');
                // This will be handled by the general voice processing
            }

            showCommandHint() {
                const hint = document.getElementById('voiceCommandHint');
                if (hint) {
                    hint.classList.add('show');
                    setTimeout(() => {
                        hint.classList.remove('show');
                    }, 5000);
                }
            }

            handleError(error) {
                let errorMessage = 'Voice recognition error';
                let showRetry = false;
                
                switch (error) {
                    case 'no-speech':
                        errorMessage = 'No speech detected. Please try again.';
                        showRetry = true;
                        break;
                    case 'audio-capture':
                        errorMessage = 'Microphone not found. Please check your microphone.';
                        break;
                    case 'not-allowed':
                        errorMessage = 'Microphone access denied. Please allow microphone access.';
                        break;
                    case 'network':
                        errorMessage = 'Network error. Trying offline mode...';
                        this.tryOfflineMode();
                        return;
                    case 'service-not-allowed':
                        errorMessage = 'Speech service not available. Please try again later.';
                        showRetry = true;
                        break;
                    case 'bad-grammar':
                        errorMessage = 'Speech recognition grammar error.';
                        break;
                    default:
                        errorMessage = `Error: ${error}. Please try again.`;
                        showRetry = true;
                }
                
                this.showStatus(`âŒ ${errorMessage}`, 'error');
                this.stopRecording();
                
                if (showRetry) {
                    setTimeout(() => {
                        this.showStatus('ðŸ”„ Click microphone to retry', 'info');
                    }, 2000);
                }
            }

            tryOfflineMode() {
                this.showStatus('ðŸ”„ Switching to offline mode...', 'info');
                
                // Show error fix options
                this.showErrorFix();
                
                // Try to use a different approach or show manual input option
                setTimeout(() => {
                    this.showStatus('ðŸ’¡ Voice temporarily unavailable. Use text input instead.', 'info');
                    this.showManualInputOption();
                }, 1500);
            }

            showErrorFix() {
                const errorFix = document.getElementById('voiceErrorFix');
                if (errorFix) {
                    errorFix.classList.add('show');
                    setTimeout(() => {
                        errorFix.classList.remove('show');
                    }, 8000);
                }
            }

            // Show error fix panel for testing
            showErrorFixPanel() {
                this.showErrorFix();
            }

            retryVoiceRecognition() {
                this.hideErrorFix();
                this.showStatus('ðŸ”„ Retrying voice recognition...', 'info');
                
                // Wait a moment then try again
                setTimeout(() => {
                    this.toggleVoiceRecording();
                }, 1000);
            }

            hideErrorFix() {
                const errorFix = document.getElementById('voiceErrorFix');
                if (errorFix) {
                    errorFix.classList.remove('show');
                }
            }

            showManualInputOption() {
                const chatInput = document.getElementById('chatInput');
                if (chatInput) {
                    chatInput.focus();
                    chatInput.placeholder = 'Voice input unavailable - please type your message here';
                    chatInput.style.border = '2px solid var(--primary-teal)';
                    
                    setTimeout(() => {
                        chatInput.style.border = '';
                        chatInput.placeholder = 'Type your message here...';
                    }, 5000);
                }
            }

            updateUI(state) {
                const voiceBtn = document.getElementById('voiceBtn');
                if (!voiceBtn) return;

                voiceBtn.className = 'voice-floating-btn';
                
                switch (state) {
                    case 'recording':
                        voiceBtn.classList.add('recording');
                        voiceBtn.innerHTML = 'â¹ï¸';
                        break;
                    case 'processing':
                        voiceBtn.classList.add('processing');
                        voiceBtn.innerHTML = 'â³';
                        break;
                    case 'idle':
                    default:
                        voiceBtn.innerHTML = 'ðŸŽ¤';
                        break;
                }
            }

            showStatus(message, type = 'info') {
                const status = document.getElementById('voiceStatus');
                if (status) {
                    status.textContent = message;
                    status.classList.add('show');
                    
                    setTimeout(() => {
                        status.classList.remove('show');
                    }, 3000);
                }
            }

            showWaveform() {
                const waveform = document.getElementById('voiceWaveform');
                if (waveform) {
                    waveform.classList.add('show');
                }
            }

            hideWaveform() {
                const waveform = document.getElementById('voiceWaveform');
                if (waveform) {
                    waveform.classList.remove('show');
                }
            }

            startCountdown() {
                this.timeRemaining = 30;
                this.countdownTimer = setInterval(() => {
                    this.timeRemaining--;
                    
                    if (this.timeRemaining > 0) {
                        this.showStatus(`ðŸŽ¤ Listening... ${this.timeRemaining} seconds remaining`);
                    } else {
                        this.stopCountdown();
                    }
                }, 1000);
            }

            stopCountdown() {
                if (this.countdownTimer) {
                    clearInterval(this.countdownTimer);
                    this.countdownTimer = null;
                }
            }

            showStopButton() {
                const stopBtn = document.getElementById('voiceStopBtn');
                if (stopBtn) {
                    stopBtn.style.display = 'block';
                }
            }

            hideStopButton() {
                const stopBtn = document.getElementById('voiceStopBtn');
                if (stopBtn) {
                    stopBtn.style.display = 'none';
                }
            }
        }

        // Initialize voice assistant
        let voiceAssistant;
        document.addEventListener('DOMContentLoaded', function() {
            voiceAssistant = new VoiceAssistant();
        });

        // Global function for the voice button
        function toggleVoiceRecording() {
            if (voiceAssistant) {
                voiceAssistant.toggleVoiceRecording();
            }
        }

    </script>
</body>
</html>
